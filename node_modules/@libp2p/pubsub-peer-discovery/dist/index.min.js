(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.Libp2PPubsubPeerDiscovery = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var Libp2PPubsubPeerDiscovery=(()=>{var Yr=Object.defineProperty;var Ji=Object.getOwnPropertyDescriptor;var Qi=Object.getOwnPropertyNames;var ta=Object.prototype.hasOwnProperty;var ut=(e,t)=>{for(var r in t)Yr(e,r,{get:t[r],enumerable:!0})},ea=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Qi(t))!ta.call(e,o)&&o!==r&&Yr(e,o,{get:()=>t[o],enumerable:!(n=Ji(t,o))||n.enumerable});return e};var ra=e=>ea(Yr({},"__esModule",{value:!0}),e);var Cu={};ut(Cu,{PubSubPeerDiscovery:()=>Zr,TOPIC:()=>Xi,pubsubPeerDiscovery:()=>_u});var Mo=Symbol.for("@libp2p/peer-discovery");var Xr=Symbol.for("@libp2p/peer-id");var W=class extends Error{static name="InvalidParametersError";constructor(t="Invalid parameters"){super(t),this.name="InvalidParametersError"}},ae=class extends Error{static name="InvalidPublicKeyError";constructor(t="Invalid public key"){super(t),this.name="InvalidPublicKeyError"}};var ce=class extends Error{static name="UnsupportedKeyTypeError";constructor(t="Unsupported key type"){super(t),this.name="UnsupportedKeyTypeError"}};var ar=class extends EventTarget{#t=new Map;constructor(){super()}listenerCount(t){let r=this.#t.get(t);return r==null?0:r.length}addEventListener(t,r,n){super.addEventListener(t,r,n);let o=this.#t.get(t);o==null&&(o=[],this.#t.set(t,o)),o.push({callback:r,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(t,r,n){super.removeEventListener(t.toString(),r??null,n);let o=this.#t.get(t);o!=null&&(o=o.filter(({callback:s})=>s!==r),this.#t.set(t,o))}dispatchEvent(t){let r=super.dispatchEvent(t),n=this.#t.get(t.type);return n==null||(n=n.filter(({once:o})=>!o),this.#t.set(t.type,n)),r}safeDispatchEvent(t,r={}){return this.dispatchEvent(new CustomEvent(t,r))}};var rn={};ut(rn,{base58btc:()=>V,base58flickr:()=>fa});var Uu=new Uint8Array(0);function Ho(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function Ct(e){if(e instanceof Uint8Array&&e.constructor.name==="Uint8Array")return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function qo(e){return new TextEncoder().encode(e)}function Vo(e){return new TextDecoder().decode(e)}function na(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var s=e.charAt(o),i=s.charCodeAt(0);if(r[i]!==255)throw new TypeError(s+" is ambiguous");r[i]=o}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function u(S){if(S instanceof Uint8Array||(ArrayBuffer.isView(S)?S=new Uint8Array(S.buffer,S.byteOffset,S.byteLength):Array.isArray(S)&&(S=Uint8Array.from(S))),!(S instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(S.length===0)return"";for(var E=0,m=0,v=0,T=S.length;v!==T&&S[v]===0;)v++,E++;for(var I=(T-v)*f+1>>>0,L=new Uint8Array(I);v!==T;){for(var p=S[v],P=0,D=I-1;(p!==0||P<m)&&D!==-1;D--,P++)p+=256*L[D]>>>0,L[D]=p%a>>>0,p=p/a>>>0;if(p!==0)throw new Error("Non-zero carry");m=P,v++}for(var B=I-m;B!==I&&L[B]===0;)B++;for(var h=c.repeat(E);B<I;++B)h+=e.charAt(L[B]);return h}function x(S){if(typeof S!="string")throw new TypeError("Expected String");if(S.length===0)return new Uint8Array;var E=0;if(S[E]!==" "){for(var m=0,v=0;S[E]===c;)m++,E++;for(var T=(S.length-E)*l+1>>>0,I=new Uint8Array(T);S[E];){var L=r[S.charCodeAt(E)];if(L===255)return;for(var p=0,P=T-1;(L!==0||p<v)&&P!==-1;P--,p++)L+=a*I[P]>>>0,I[P]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");v=p,E++}if(S[E]!==" "){for(var D=T-v;D!==T&&I[D]===0;)D++;for(var B=new Uint8Array(m+(T-D)),h=m;D!==T;)B[h++]=I[D++];return B}}}function b(S){var E=x(S);if(E)return E;throw new Error(`Non-${t} character`)}return{encode:u,decodeUnsafe:x,decode:b}}var oa=na,sa=oa,Fo=sa;var Jr=class{name;prefix;baseEncode;constructor(t,r,n){this.name=t,this.prefix=r,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}},Qr=class{name;prefix;baseDecode;prefixCodePoint;constructor(t,r,n){this.name=t,this.prefix=r;let o=r.codePointAt(0);if(o===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=o,this.baseDecode=n}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return jo(this,t)}},tn=class{decoders;constructor(t){this.decoders=t}or(t){return jo(this,t)}decode(t){let r=t[0],n=this.decoders[r];if(n!=null)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};function jo(e,t){return new tn({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}var en=class{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(t,r,n,o){this.name=t,this.prefix=r,this.baseEncode=n,this.baseDecode=o,this.encoder=new Jr(t,r,n),this.decoder=new Qr(t,r,o)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}};function fe({name:e,prefix:t,encode:r,decode:n}){return new en(e,t,r,n)}function kt({name:e,prefix:t,alphabet:r}){let{encode:n,decode:o}=Fo(r,e);return fe({prefix:t,name:e,encode:n,decode:s=>Ct(o(s))})}function ia(e,t,r,n){let o=e.length;for(;e[o-1]==="=";)--o;let s=new Uint8Array(o*r/8|0),i=0,a=0,c=0;for(let l=0;l<o;++l){let f=t[e[l]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<r|f,i+=r,i>=8&&(i-=8,s[c++]=255&a>>i)}if(i>=r||(255&a<<8-i)!==0)throw new SyntaxError("Unexpected end of data");return s}function aa(e,t,r){let n=t[t.length-1]==="=",o=(1<<r)-1,s="",i=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],i+=8;i>r;)i-=r,s+=t[o&a>>i];if(i!==0&&(s+=t[o&a<<r-i]),n)for(;(s.length*r&7)!==0;)s+="=";return s}function ca(e){let t={};for(let r=0;r<e.length;++r)t[e[r]]=r;return t}function j({name:e,prefix:t,bitsPerChar:r,alphabet:n}){let o=ca(n);return fe({prefix:t,name:e,encode(s){return aa(s,n,r)},decode(s){return ia(s,o,r,e)}})}var V=kt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),fa=kt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var nn={};ut(nn,{base32:()=>Mt,base32hex:()=>da,base32hexpad:()=>ma,base32hexpadupper:()=>ya,base32hexupper:()=>pa,base32pad:()=>la,base32padupper:()=>ha,base32upper:()=>ua,base32z:()=>ba});var Mt=j({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ua=j({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),la=j({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ha=j({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),da=j({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),pa=j({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ma=j({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ya=j({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ba=j({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var on={};ut(on,{base36:()=>Le,base36upper:()=>xa});var Le=kt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),xa=kt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ga=Zo,Go=128,wa=127,Ea=~wa,Sa=Math.pow(2,31);function Zo(e,t,r){t=t||[],r=r||0;for(var n=r;e>=Sa;)t[r++]=e&255|Go,e/=128;for(;e&Ea;)t[r++]=e&255|Go,e>>>=7;return t[r]=e|0,Zo.bytes=r-n+1,t}var va=sn,Aa=128,$o=127;function sn(e,n){var r=0,n=n||0,o=0,s=n,i,a=e.length;do{if(s>=a)throw sn.bytes=0,new RangeError("Could not decode varint");i=e[s++],r+=o<28?(i&$o)<<o:(i&$o)*Math.pow(2,o),o+=7}while(i>=Aa);return sn.bytes=s-n,r}var Ia=Math.pow(2,7),Ba=Math.pow(2,14),_a=Math.pow(2,21),Ca=Math.pow(2,28),Ta=Math.pow(2,35),Da=Math.pow(2,42),Pa=Math.pow(2,49),La=Math.pow(2,56),Oa=Math.pow(2,63),Ua=function(e){return e<Ia?1:e<Ba?2:e<_a?3:e<Ca?4:e<Ta?5:e<Da?6:e<Pa?7:e<La?8:e<Oa?9:10},Ka={encode:ga,decode:va,encodingLength:Ua},Ra=Ka,Oe=Ra;function Ue(e,t=0){return[Oe.decode(e,t),Oe.decode.bytes]}function ue(e,t,r=0){return Oe.encode(e,t,r),t}function le(e){return Oe.encodingLength(e)}function xt(e,t){let r=t.byteLength,n=le(e),o=n+le(r),s=new Uint8Array(o+r);return ue(e,s,0),ue(r,s,n),s.set(t,o),new he(e,r,t,s)}function an(e){let t=Ct(e),[r,n]=Ue(t),[o,s]=Ue(t.subarray(n)),i=t.subarray(n+s);if(i.byteLength!==o)throw new Error("Incorrect length");return new he(r,o,i,t)}function Wo(e,t){if(e===t)return!0;{let r=t;return e.code===r.code&&e.size===r.size&&r.bytes instanceof Uint8Array&&Ho(e.bytes,r.bytes)}}var he=class{code;size;digest;bytes;constructor(t,r,n,o){this.code=t,this.size=r,this.digest=n,this.bytes=o}};function Yo(e,t){let{bytes:r,version:n}=e;switch(n){case 0:return ka(r,cn(e),t??V.encoder);default:return Ma(r,cn(e),t??Mt.encoder)}}var Xo=new WeakMap;function cn(e){let t=Xo.get(e);if(t==null){let r=new Map;return Xo.set(e,r),r}return t}var Z=class e{code;version;multihash;bytes;"/";constructor(t,r,n,o){this.code=r,this.version=t,this.multihash=n,this.bytes=o,this["/"]=o}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:t,multihash:r}=this;if(t!==Ke)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Ha)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return e.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:t,digest:r}=this.multihash,n=xt(t,r);return e.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return e.equals(this,t)}static equals(t,r){let n=r;return n!=null&&t.code===n.code&&t.version===n.version&&Wo(t.multihash,n.multihash)}toString(t){return Yo(this,t)}toJSON(){return{"/":Yo(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(t==null)return null;let r=t;if(r instanceof e)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:o,multihash:s,bytes:i}=r;return new e(n,o,s,i??Jo(n,o,s.bytes))}else if(r[qa]===!0){let{version:n,multihash:o,code:s}=r,i=an(o);return e.create(n,s,i)}else return null}static create(t,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:{if(r!==Ke)throw new Error(`Version 0 CID must use dag-pb (code: ${Ke}) block encoding`);return new e(t,r,n,n.bytes)}case 1:{let o=Jo(t,r,n.bytes);return new e(t,r,n,o)}default:throw new Error("Invalid version")}}static createV0(t){return e.create(0,Ke,t)}static createV1(t,r){return e.create(1,t,r)}static decode(t){let[r,n]=e.decodeFirst(t);if(n.length!==0)throw new Error("Incorrect length");return r}static decodeFirst(t){let r=e.inspectBytes(t),n=r.size-r.multihashSize,o=Ct(t.subarray(n,n+r.multihashSize));if(o.byteLength!==r.multihashSize)throw new Error("Incorrect length");let s=o.subarray(r.multihashSize-r.digestSize),i=new he(r.multihashCode,r.digestSize,s,o);return[r.version===0?e.createV0(i):e.createV1(r.codec,i),t.subarray(r.size)]}static inspectBytes(t){let r=0,n=()=>{let[u,x]=Ue(t.subarray(r));return r+=x,u},o=n(),s=Ke;if(o===18?(o=0,r=0):s=n(),o!==0&&o!==1)throw new RangeError(`Invalid CID version ${o}`);let i=r,a=n(),c=n(),l=r+c,f=l-i;return{version:o,codec:s,multihashCode:a,digestSize:c,multihashSize:f,size:l}}static parse(t,r){let[n,o]=Na(t,r),s=e.decode(o);if(s.version===0&&t[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return cn(s).set(n,t),s}};function Na(e,t){switch(e[0]){case"Q":{let r=t??V;return[V.prefix,r.decode(`${V.prefix}${e}`)]}case V.prefix:{let r=t??V;return[V.prefix,r.decode(e)]}case Mt.prefix:{let r=t??Mt;return[Mt.prefix,r.decode(e)]}case Le.prefix:{let r=t??Le;return[Le.prefix,r.decode(e)]}default:{if(t==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}}function ka(e,t,r){let{prefix:n}=r;if(n!==V.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let o=t.get(n);if(o==null){let s=r.encode(e).slice(1);return t.set(n,s),s}else return o}function Ma(e,t,r){let{prefix:n}=r,o=t.get(n);if(o==null){let s=r.encode(e);return t.set(n,s),s}else return o}var Ke=112,Ha=18;function Jo(e,t,r){let n=le(e),o=n+le(t),s=new Uint8Array(o+r.byteLength);return ue(e,s,0),ue(t,s,n),s.set(r,o),s}var qa=Symbol.for("@ipld/js-cid/CID");var fn={};ut(fn,{identity:()=>vt});var Qo=0,Va="identity",ts=Ct;function za(e){return xt(Qo,ts(e))}var vt={code:Qo,name:Va,encode:ts,digest:za};function nt(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}function gt(e=0){return new Uint8Array(e)}function ht(e=0){return new Uint8Array(e)}function Tt(e,t){t==null&&(t=e.reduce((o,s)=>o+s.length,0));let r=ht(t),n=0;for(let o of e)r.set(o,n),n+=o.length;return r}var rs=Symbol.for("@achingbrain/uint8arraylist");function es(e,t){if(t==null||t<0)throw new RangeError("index is out of bounds");let r=0;for(let n of e){let o=r+n.byteLength;if(t<o)return{buf:n,index:t-r};r=o}throw new RangeError("index is out of bounds")}function fr(e){return!!e?.[rs]}var dt=class e{bufs;length;[rs]=!0;constructor(...t){this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let r=0;for(let n of t)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(fr(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...t){this.prependAll(t)}prependAll(t){let r=0;for(let n of t.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(fr(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(t){let r=es(this.bufs,t);return r.buf[r.index]}set(t,r){let n=es(this.bufs,t);n.buf[n.index]=r}write(t,r=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(r+n,t[n]);else if(fr(t))for(let n=0;n<t.length;n++)this.set(r+n,t.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(t>=this.bufs[0].byteLength)t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}}}slice(t,r){let{bufs:n,length:o}=this._subList(t,r);return Tt(n,o)}subarray(t,r){let{bufs:n,length:o}=this._subList(t,r);return n.length===1?n[0]:Tt(n,o)}sublist(t,r){let{bufs:n,length:o}=this._subList(t,r),s=new e;return s.length=o,s.bufs=[...n],s}_subList(t,r){if(t=t??0,r=r??this.length,t<0&&(t=this.length+t),r<0&&(r=this.length+r),t<0||r>this.length)throw new RangeError("index is out of bounds");if(t===r)return{bufs:[],length:0};if(t===0&&r===this.length)return{bufs:this.bufs,length:this.length};let n=[],o=0;for(let s=0;s<this.bufs.length;s++){let i=this.bufs[s],a=o,c=a+i.byteLength;if(o=c,t>=c)continue;let l=t>=a&&t<c,f=r>a&&r<=c;if(l&&f){if(t===a&&r===c){n.push(i);break}let u=t-a;n.push(i.subarray(u,u+(r-t)));break}if(l){if(t===0){n.push(i);continue}n.push(i.subarray(t-a));continue}if(f){if(r===c){n.push(i);break}n.push(i.subarray(0,r-a));break}n.push(i)}return{bufs:n,length:r-t}}indexOf(t,r=0){if(!fr(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=t instanceof Uint8Array?t:t.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),t.length===0)return r>this.length?this.length:r;let o=n.byteLength;if(o===0)throw new TypeError("search must be at least 1 byte long");let s=256,i=new Int32Array(s);for(let u=0;u<s;u++)i[u]=-1;for(let u=0;u<o;u++)i[n[u]]=u;let a=i,c=this.byteLength-n.byteLength,l=n.byteLength-1,f;for(let u=r;u<=c;u+=f){f=0;for(let x=l;x>=0;x--){let b=this.get(u+x);if(n[x]!==b){f=Math.max(1,x-a[b]);break}}if(f===0)return u}return-1}getInt8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(t,r){let n=ht(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,t)}getInt16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(t,r,n){let o=gt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt16(0,r,n),this.write(o,t)}getInt32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(t,r,n){let o=gt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setInt32(0,r,n),this.write(o,t)}getBigInt64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(t,r,n){let o=gt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigInt64(0,r,n),this.write(o,t)}getUint8(t){let r=this.subarray(t,t+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(t,r){let n=ht(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,t)}getUint16(t,r){let n=this.subarray(t,t+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(t,r,n){let o=gt(2);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint16(0,r,n),this.write(o,t)}getUint32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(t,r,n){let o=gt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setUint32(0,r,n),this.write(o,t)}getBigUint64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(t,r,n){let o=gt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setBigUint64(0,r,n),this.write(o,t)}getFloat32(t,r){let n=this.subarray(t,t+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(t,r,n){let o=gt(4);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat32(0,r,n),this.write(o,t)}getFloat64(t,r){let n=this.subarray(t,t+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(t,r,n){let o=gt(8);new DataView(o.buffer,o.byteOffset,o.byteLength).setFloat64(0,r,n),this.write(o,t)}equals(t){if(t==null||!(t instanceof e)||t.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!nt(this.bufs[r],t.bufs[r]))return!1;return!0}static fromUint8Arrays(t,r){let n=new e;return n.bufs=t,r==null&&(r=t.reduce((o,s)=>o+s.byteLength,0)),n.length=r,n}};var un={};ut(un,{base10:()=>Fa});var Fa=kt({prefix:"9",name:"base10",alphabet:"0123456789"});var ln={};ut(ln,{base16:()=>ja,base16upper:()=>Ga});var ja=j({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ga=j({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var hn={};ut(hn,{base2:()=>$a});var $a=j({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var dn={};ut(dn,{base256emoji:()=>Ja});var ns=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Za=ns.reduce((e,t,r)=>(e[r]=t,e),[]),Wa=ns.reduce((e,t,r)=>{let n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);return e[n]=r,e},[]);function Ya(e){return e.reduce((t,r)=>(t+=Za[r],t),"")}function Xa(e){let t=[];for(let r of e){let n=r.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${r}`);let o=Wa[n];if(o==null)throw new Error(`Non-base256emoji character: ${r}`);t.push(o)}return new Uint8Array(t)}var Ja=fe({prefix:"\u{1F680}",name:"base256emoji",encode:Ya,decode:Xa});var mn={};ut(mn,{base64:()=>Qa,base64pad:()=>tc,base64url:()=>pn,base64urlpad:()=>ec});var Qa=j({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),tc=j({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),pn=j({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),ec=j({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var yn={};ut(yn,{base8:()=>rc});var rc=j({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var bn={};ut(bn,{identity:()=>nc});var nc=fe({prefix:"\0",name:"identity",encode:e=>Vo(e),decode:e=>qo(e)});var bl=new TextEncoder,xl=new TextDecoder;var wn={};ut(wn,{sha256:()=>ur,sha512:()=>ic});function gn({name:e,code:t,encode:r}){return new xn(e,t,r)}var xn=class{name;code;encode;constructor(t,r,n){this.name=t,this.code=r,this.encode=n}digest(t){if(t instanceof Uint8Array){let r=this.encode(t);return r instanceof Uint8Array?xt(this.code,r):r.then(n=>xt(this.code,n))}else throw Error("Unknown type, must be binary type")}};function ss(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}var ur=gn({name:"sha2-256",code:18,encode:ss("SHA-256")}),ic=gn({name:"sha2-512",code:19,encode:ss("SHA-512")});var Re={...bn,...hn,...yn,...un,...ln,...nn,...on,...rn,...mn,...dn},Dl={...wn,...fn};function as(e,t,r,n){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:r},decoder:{decode:n}}}var is=as("utf8","u",e=>"u"+new TextDecoder("utf8").decode(e),e=>new TextEncoder().encode(e.substring(1))),En=as("ascii","a",e=>{let t="a";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t},e=>{e=e.substring(1);let t=ht(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}),ac={utf8:is,"utf-8":is,hex:Re.base16,latin1:En,ascii:En,binary:En,...Re},lr=ac;function k(e,t="utf8"){let r=lr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.decoder.decode(`${r.prefix}${e}`)}function R(e,t="utf8"){let r=lr[t];if(r==null)throw new Error(`Unsupported encoding "${t}"`);return r.encoder.encode(e).substring(1)}var cc=parseInt("11111",2),Sn=parseInt("10000000",2),fc=parseInt("01111111",2),cs={0:Ne,1:Ne,2:uc,3:dc,4:pc,5:hc,6:lc,16:Ne,22:Ne,48:Ne};function Dt(e,t={offset:0}){let r=e[t.offset]&cc;if(t.offset++,cs[r]!=null)return cs[r](e,t);throw new Error("No decoder for tag "+r)}function ke(e,t){let r=0;if((e[t.offset]&Sn)===Sn){let n=e[t.offset]&fc,o="0x";t.offset++;for(let s=0;s<n;s++,t.offset++)o+=e[t.offset].toString(16).padStart(2,"0");r=parseInt(o,16)}else r=e[t.offset],t.offset++;return r}function Ne(e,t){ke(e,t);let r=[];for(;!(t.offset>=e.byteLength);){let n=Dt(e,t);if(n===null)break;r.push(n)}return r}function uc(e,t){let r=ke(e,t),n=t.offset,o=t.offset+r,s=[];for(let i=n;i<o;i++)i===n&&e[i]===0||s.push(e[i]);return t.offset+=r,Uint8Array.from(s)}function lc(e,t){let r=ke(e,t),n=t.offset+r,o=e[t.offset];t.offset++;let s=0,i=0;o<40?(s=0,i=o):o<80?(s=1,i=o-40):(s=2,i=o-80);let a=`${s}.${i}`,c=[];for(;t.offset<n;){let l=e[t.offset];if(t.offset++,c.push(l&127),l<128){c.reverse();let f=0;for(let u=0;u<c.length;u++)f+=c[u]<<u*7;a+=`.${f}`,c=[]}}return a}function hc(e,t){return t.offset++,null}function dc(e,t){let r=ke(e,t),n=e[t.offset];t.offset++;let o=e.subarray(t.offset,t.offset+r-1);if(t.offset+=r,n!==0)throw new Error("Unused bits in bit string is unimplemented");return o}function pc(e,t){let r=ke(e,t),n=e.subarray(t.offset,t.offset+r);return t.offset+=r,n}function mc(e){let t=e.toString(16);t.length%2===1&&(t="0"+t);let r=new dt;for(let n=0;n<t.length;n+=2)r.append(Uint8Array.from([parseInt(`${t[n]}${t[n+1]}`,16)]));return r}function vn(e){if(e.byteLength<128)return Uint8Array.from([e.byteLength]);let t=mc(e.byteLength);return new dt(Uint8Array.from([t.byteLength|Sn]),t)}function lt(e){let t=new dt,r=128;return(e.subarray()[0]&r)===r&&t.append(Uint8Array.from([0])),t.append(e),new dt(Uint8Array.from([2]),vn(t),t)}function hr(e){let t=Uint8Array.from([0]),r=new dt(t,e);return new dt(Uint8Array.from([3]),vn(r),r)}function Ht(e,t=48){let r=new dt;for(let n of e)r.append(n);return new dt(Uint8Array.from([t]),vn(r),r)}async function fs(e,t,r,n){let o=await crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:e.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();let s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,t,r.subarray());return n?.signal?.throwIfAborted(),s}var yc=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),bc=Uint8Array.from([6,5,43,129,4,0,34]),xc=Uint8Array.from([6,5,43,129,4,0,35]),gc={ext:!0,kty:"EC",crv:"P-256"},wc={ext:!0,kty:"EC",crv:"P-384"},Ec={ext:!0,kty:"EC",crv:"P-521"},An=32,In=48,Bn=66;function us(e){let t=Dt(e);return ls(t)}function ls(e){let t=e[1][1][0],r=1,n,o;if(t.byteLength===An*2+1)return n=R(t.subarray(r,r+An),"base64url"),o=R(t.subarray(r+An),"base64url"),new pe({...gc,key_ops:["verify"],x:n,y:o});if(t.byteLength===In*2+1)return n=R(t.subarray(r,r+In),"base64url"),o=R(t.subarray(r+In),"base64url"),new pe({...wc,key_ops:["verify"],x:n,y:o});if(t.byteLength===Bn*2+1)return n=R(t.subarray(r,r+Bn),"base64url"),o=R(t.subarray(r+Bn),"base64url"),new pe({...Ec,key_ops:["verify"],x:n,y:o});throw new W(`coordinates were wrong length, got ${t.byteLength}, expected 65, 97 or 133`)}function hs(e){return Ht([lt(Uint8Array.from([1])),Ht([Sc(e.crv)],160),Ht([hr(new dt(Uint8Array.from([4]),k(e.x??"","base64url"),k(e.y??"","base64url")))],161)]).subarray()}function Sc(e){if(e==="P-256")return yc;if(e==="P-384")return bc;if(e==="P-521")return xc;throw new W(`Invalid curve ${e}`)}var pe=class{type="ECDSA";jwk;_raw;constructor(t){this.jwk=t}get raw(){return this._raw==null&&(this._raw=hs(this.jwk)),this._raw}toMultihash(){return vt.digest(qt(this))}toCID(){return Z.createV1(114,this.toMultihash())}toString(){return V.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:nt(this.raw,t.raw)}async verify(t,r,n){return fs(this.jwk,r,t,n)}};var Wt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function ye(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Me(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function ot(e,...t){if(!ye(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function ps(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Me(e.outputLen),Me(e.blockLen)}function be(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ms(e,t){ot(e);let r=t.outputLen;if(e.length<r)throw new Error("digestInto() expects output buffer of length at least "+r)}function Lt(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function dr(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function wt(e,t){return e<<32-t|e>>>t}var ys=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",vc=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function At(e){if(ot(e),ys)return e.toHex();let t="";for(let r=0;r<e.length;r++)t+=vc[e[r]];return t}var Pt={_0:48,_9:57,A:65,F:70,a:97,f:102};function ds(e){if(e>=Pt._0&&e<=Pt._9)return e-Pt._0;if(e>=Pt.A&&e<=Pt.F)return e-(Pt.A-10);if(e>=Pt.a&&e<=Pt.f)return e-(Pt.a-10)}function xe(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);if(ys)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw new Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let o=0,s=0;o<r;o++,s+=2){let i=ds(e.charCodeAt(s)),a=ds(e.charCodeAt(s+1));if(i===void 0||a===void 0){let c=e[s]+e[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[o]=i*16+a}return n}function bs(e){if(typeof e!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}function He(e){return typeof e=="string"&&(e=bs(e)),ot(e),e}function pt(...e){let t=0;for(let n=0;n<e.length;n++){let o=e[n];ot(o),t+=o.length}let r=new Uint8Array(t);for(let n=0,o=0;n<e.length;n++){let s=e[n];r.set(s,o),o+=s.length}return r}var me=class{};function _n(e){let t=n=>e().update(He(n)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function qe(e=32){if(Wt&&typeof Wt.getRandomValues=="function")return Wt.getRandomValues(new Uint8Array(e));if(Wt&&typeof Wt.randomBytes=="function")return Uint8Array.from(Wt.randomBytes(e));throw new Error("crypto.getRandomValues must be defined")}function Ac(e,t,r,n){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,n);let o=BigInt(32),s=BigInt(4294967295),i=Number(r>>o&s),a=Number(r&s),c=n?4:0,l=n?0:4;e.setUint32(t+c,i,n),e.setUint32(t+l,a,n)}function xs(e,t,r){return e&t^~e&r}function gs(e,t,r){return e&t^e&r^t&r}var Ve=class extends me{constructor(t,r,n,o){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=t,this.outputLen=r,this.padOffset=n,this.isLE=o,this.buffer=new Uint8Array(t),this.view=dr(this.buffer)}update(t){be(this),t=He(t),ot(t);let{view:r,buffer:n,blockLen:o}=this,s=t.length;for(let i=0;i<s;){let a=Math.min(o-this.pos,s-i);if(a===o){let c=dr(t);for(;o<=s-i;i+=o)this.process(c,i);continue}n.set(t.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){be(this),ms(t,this),this.finished=!0;let{buffer:r,view:n,blockLen:o,isLE:s}=this,{pos:i}=this;r[i++]=128,Lt(this.buffer.subarray(i)),this.padOffset>o-i&&(this.process(n,0),i=0);for(let u=i;u<o;u++)r[u]=0;Ac(n,o-8,BigInt(this.length*8),s),this.process(n,0);let a=dr(t),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,f[u],s)}digest(){let{buffer:t,outputLen:r}=this;this.digestInto(t);let n=t.slice(0,r);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());let{blockLen:r,buffer:n,length:o,finished:s,destroyed:i,pos:a}=this;return t.destroyed=i,t.finished=s,t.length=o,t.pos=a,o%r&&t.buffer.set(n),t}clone(){return this._cloneInto()}},Ot=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]);var Q=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]);var pr=BigInt(4294967295),ws=BigInt(32);function Ic(e,t=!1){return t?{h:Number(e&pr),l:Number(e>>ws&pr)}:{h:Number(e>>ws&pr)|0,l:Number(e&pr)|0}}function Es(e,t=!1){let r=e.length,n=new Uint32Array(r),o=new Uint32Array(r);for(let s=0;s<r;s++){let{h:i,l:a}=Ic(e[s],t);[n[s],o[s]]=[i,a]}return[n,o]}var Cn=(e,t,r)=>e>>>r,Tn=(e,t,r)=>e<<32-r|t>>>r,Yt=(e,t,r)=>e>>>r|t<<32-r,Xt=(e,t,r)=>e<<32-r|t>>>r,ze=(e,t,r)=>e<<64-r|t>>>r-32,Fe=(e,t,r)=>e>>>r-32|t<<64-r;function It(e,t,r,n){let o=(t>>>0)+(n>>>0);return{h:e+r+(o/2**32|0)|0,l:o|0}}var Ss=(e,t,r)=>(e>>>0)+(t>>>0)+(r>>>0),vs=(e,t,r,n)=>t+r+n+(e/2**32|0)|0,As=(e,t,r,n)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0),Is=(e,t,r,n,o)=>t+r+n+o+(e/2**32|0)|0,Bs=(e,t,r,n,o)=>(e>>>0)+(t>>>0)+(r>>>0)+(n>>>0)+(o>>>0),_s=(e,t,r,n,o,s)=>t+r+n+o+s+(e/2**32|0)|0;var _c=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Vt=new Uint32Array(64),mr=class extends Ve{constructor(t=32){super(64,t,8,!1),this.A=Ot[0]|0,this.B=Ot[1]|0,this.C=Ot[2]|0,this.D=Ot[3]|0,this.E=Ot[4]|0,this.F=Ot[5]|0,this.G=Ot[6]|0,this.H=Ot[7]|0}get(){let{A:t,B:r,C:n,D:o,E:s,F:i,G:a,H:c}=this;return[t,r,n,o,s,i,a,c]}set(t,r,n,o,s,i,a,c){this.A=t|0,this.B=r|0,this.C=n|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(t,r){for(let u=0;u<16;u++,r+=4)Vt[u]=t.getUint32(r,!1);for(let u=16;u<64;u++){let x=Vt[u-15],b=Vt[u-2],S=wt(x,7)^wt(x,18)^x>>>3,E=wt(b,17)^wt(b,19)^b>>>10;Vt[u]=E+Vt[u-7]+S+Vt[u-16]|0}let{A:n,B:o,C:s,D:i,E:a,F:c,G:l,H:f}=this;for(let u=0;u<64;u++){let x=wt(a,6)^wt(a,11)^wt(a,25),b=f+x+xs(a,c,l)+_c[u]+Vt[u]|0,E=(wt(n,2)^wt(n,13)^wt(n,22))+gs(n,o,s)|0;f=l,l=c,c=a,a=i+b|0,i=s,s=o,o=n,n=b+E|0}n=n+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(n,o,s,i,a,c,l,f)}roundClean(){Lt(Vt)}destroy(){this.set(0,0,0,0,0,0,0,0),Lt(this.buffer)}};var Cs=Es(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),Cc=Cs[0],Tc=Cs[1],zt=new Uint32Array(80),Ft=new Uint32Array(80),Dn=class extends Ve{constructor(t=64){super(128,t,16,!1),this.Ah=Q[0]|0,this.Al=Q[1]|0,this.Bh=Q[2]|0,this.Bl=Q[3]|0,this.Ch=Q[4]|0,this.Cl=Q[5]|0,this.Dh=Q[6]|0,this.Dl=Q[7]|0,this.Eh=Q[8]|0,this.El=Q[9]|0,this.Fh=Q[10]|0,this.Fl=Q[11]|0,this.Gh=Q[12]|0,this.Gl=Q[13]|0,this.Hh=Q[14]|0,this.Hl=Q[15]|0}get(){let{Ah:t,Al:r,Bh:n,Bl:o,Ch:s,Cl:i,Dh:a,Dl:c,Eh:l,El:f,Fh:u,Fl:x,Gh:b,Gl:S,Hh:E,Hl:m}=this;return[t,r,n,o,s,i,a,c,l,f,u,x,b,S,E,m]}set(t,r,n,o,s,i,a,c,l,f,u,x,b,S,E,m){this.Ah=t|0,this.Al=r|0,this.Bh=n|0,this.Bl=o|0,this.Ch=s|0,this.Cl=i|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=f|0,this.Fh=u|0,this.Fl=x|0,this.Gh=b|0,this.Gl=S|0,this.Hh=E|0,this.Hl=m|0}process(t,r){for(let I=0;I<16;I++,r+=4)zt[I]=t.getUint32(r),Ft[I]=t.getUint32(r+=4);for(let I=16;I<80;I++){let L=zt[I-15]|0,p=Ft[I-15]|0,P=Yt(L,p,1)^Yt(L,p,8)^Cn(L,p,7),D=Xt(L,p,1)^Xt(L,p,8)^Tn(L,p,7),B=zt[I-2]|0,h=Ft[I-2]|0,g=Yt(B,h,19)^ze(B,h,61)^Cn(B,h,6),d=Xt(B,h,19)^Fe(B,h,61)^Tn(B,h,6),y=As(D,d,Ft[I-7],Ft[I-16]),w=Is(y,P,g,zt[I-7],zt[I-16]);zt[I]=w|0,Ft[I]=y|0}let{Ah:n,Al:o,Bh:s,Bl:i,Ch:a,Cl:c,Dh:l,Dl:f,Eh:u,El:x,Fh:b,Fl:S,Gh:E,Gl:m,Hh:v,Hl:T}=this;for(let I=0;I<80;I++){let L=Yt(u,x,14)^Yt(u,x,18)^ze(u,x,41),p=Xt(u,x,14)^Xt(u,x,18)^Fe(u,x,41),P=u&b^~u&E,D=x&S^~x&m,B=Bs(T,p,D,Tc[I],Ft[I]),h=_s(B,v,L,P,Cc[I],zt[I]),g=B|0,d=Yt(n,o,28)^ze(n,o,34)^ze(n,o,39),y=Xt(n,o,28)^Fe(n,o,34)^Fe(n,o,39),w=n&s^n&a^s&a,_=o&i^o&c^i&c;v=E|0,T=m|0,E=b|0,m=S|0,b=u|0,S=x|0,{h:u,l:x}=It(l|0,f|0,h|0,g|0),l=a|0,f=c|0,a=s|0,c=i|0,s=n|0,i=o|0;let A=Ss(g,y,_);n=vs(A,h,d,w),o=A|0}({h:n,l:o}=It(this.Ah|0,this.Al|0,n|0,o|0)),{h:s,l:i}=It(this.Bh|0,this.Bl|0,s|0,i|0),{h:a,l:c}=It(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:f}=It(this.Dh|0,this.Dl|0,l|0,f|0),{h:u,l:x}=It(this.Eh|0,this.El|0,u|0,x|0),{h:b,l:S}=It(this.Fh|0,this.Fl|0,b|0,S|0),{h:E,l:m}=It(this.Gh|0,this.Gl|0,E|0,m|0),{h:v,l:T}=It(this.Hh|0,this.Hl|0,v|0,T|0),this.set(n,o,s,i,a,c,l,f,u,x,b,S,E,m,v,T)}roundClean(){Lt(zt,Ft)}destroy(){Lt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};var yr=_n(()=>new mr);var Ts=_n(()=>new Dn);var On=BigInt(0),Ln=BigInt(1);function Ut(e,t){if(typeof t!="boolean")throw new Error(e+" boolean expected, got "+t)}function je(e){let t=e.toString(16);return t.length&1?"0"+t:t}function Ds(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return e===""?On:BigInt("0x"+e)}function ge(e){return Ds(At(e))}function Jt(e){return ot(e),Ds(At(Uint8Array.from(e).reverse()))}function br(e,t){return xe(e.toString(16).padStart(t*2,"0"))}function we(e,t){return br(e,t).reverse()}function H(e,t,r){let n;if(typeof t=="string")try{n=xe(t)}catch(s){throw new Error(e+" must be hex string or Uint8Array, cause: "+s)}else if(ye(t))n=Uint8Array.from(t);else throw new Error(e+" must be hex string or Uint8Array");let o=n.length;if(typeof r=="number"&&o!==r)throw new Error(e+" of length "+r+" expected, got "+o);return n}var Pn=e=>typeof e=="bigint"&&On<=e;function Ps(e,t,r){return Pn(e)&&Pn(t)&&Pn(r)&&t<=e&&e<r}function jt(e,t,r,n){if(!Ps(t,r,n))throw new Error("expected valid "+e+": "+r+" <= n < "+n+", got "+t)}function Ls(e){let t;for(t=0;e>On;e>>=Ln,t+=1);return t}var Qt=e=>(Ln<<BigInt(e))-Ln;function Os(e,t,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let n=b=>new Uint8Array(b),o=b=>Uint8Array.of(b),s=n(e),i=n(e),a=0,c=()=>{s.fill(1),i.fill(0),a=0},l=(...b)=>r(i,s,...b),f=(b=n(0))=>{i=l(o(0),b),s=l(),b.length!==0&&(i=l(o(1),b),s=l())},u=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let b=0,S=[];for(;b<t;){s=l();let E=s.slice();S.push(E),b+=s.length}return pt(...S)};return(b,S)=>{c(),f(b);let E;for(;!(E=S(u()));)f();return c(),E}}function Gt(e,t,r={}){if(!e||typeof e!="object")throw new Error("expected valid options object");function n(o,s,i){let a=e[o];if(i&&a===void 0)return;let c=typeof a;if(c!==s||a===null)throw new Error(`param "${o}" is invalid: expected ${s}, got ${c}`)}Object.entries(t).forEach(([o,s])=>n(o,s,!1)),Object.entries(r).forEach(([o,s])=>n(o,s,!0))}function Ee(e){let t=new WeakMap;return(r,...n)=>{let o=t.get(r);if(o!==void 0)return o;let s=e(r,...n);return t.set(r,s),s}}var ct=BigInt(0),X=BigInt(1),te=BigInt(2),Dc=BigInt(3),Rs=BigInt(4),Ns=BigInt(5),ks=BigInt(8);function z(e,t){let r=e%t;return r>=ct?r:t+r}function q(e,t,r){let n=e;for(;t-- >ct;)n*=n,n%=r;return n}function Us(e,t){if(e===ct)throw new Error("invert: expected non-zero number");if(t<=ct)throw new Error("invert: expected positive modulus, got "+t);let r=z(e,t),n=t,o=ct,s=X,i=X,a=ct;for(;r!==ct;){let l=n/r,f=n%r,u=o-i*l,x=s-a*l;n=r,r=f,o=i,s=a,i=u,a=x}if(n!==X)throw new Error("invert: does not exist");return z(o,t)}function Ms(e,t){let r=(e.ORDER+X)/Rs,n=e.pow(t,r);if(!e.eql(e.sqr(n),t))throw new Error("Cannot find square root");return n}function Pc(e,t){let r=(e.ORDER-Ns)/ks,n=e.mul(t,te),o=e.pow(n,r),s=e.mul(t,o),i=e.mul(e.mul(s,te),o),a=e.mul(s,e.sub(i,e.ONE));if(!e.eql(e.sqr(a),t))throw new Error("Cannot find square root");return a}function Lc(e){if(e<BigInt(3))throw new Error("sqrt is not defined for small field");let t=e-X,r=0;for(;t%te===ct;)t/=te,r++;let n=te,o=Et(e);for(;Ks(o,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(r===1)return Ms;let s=o.pow(n,t),i=(t+X)/te;return function(c,l){if(c.is0(l))return l;if(Ks(c,l)!==1)throw new Error("Cannot find square root");let f=r,u=c.mul(c.ONE,s),x=c.pow(l,t),b=c.pow(l,i);for(;!c.eql(x,c.ONE);){if(c.is0(x))return c.ZERO;let S=1,E=c.sqr(x);for(;!c.eql(E,c.ONE);)if(S++,E=c.sqr(E),S===f)throw new Error("Cannot find square root");let m=X<<BigInt(f-S-1),v=c.pow(u,m);f=S,u=c.sqr(v),x=c.mul(x,u),b=c.mul(b,v)}return b}}function Oc(e){return e%Rs===Dc?Ms:e%ks===Ns?Pc:Lc(e)}var Hs=(e,t)=>(z(e,t)&X)===X,Uc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Un(e){let t={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},r=Uc.reduce((n,o)=>(n[o]="function",n),t);return Gt(e,r),e}function Kc(e,t,r){if(r<ct)throw new Error("invalid exponent, negatives unsupported");if(r===ct)return e.ONE;if(r===X)return t;let n=e.ONE,o=t;for(;r>ct;)r&X&&(n=e.mul(n,o)),o=e.sqr(o),r>>=X;return n}function Ge(e,t,r=!1){let n=new Array(t.length).fill(r?e.ZERO:void 0),o=t.reduce((i,a,c)=>e.is0(a)?i:(n[c]=i,e.mul(i,a)),e.ONE),s=e.inv(o);return t.reduceRight((i,a,c)=>e.is0(a)?i:(n[c]=e.mul(i,n[c]),e.mul(i,a)),s),n}function Ks(e,t){let r=(e.ORDER-X)/te,n=e.pow(t,r),o=e.eql(n,e.ONE),s=e.eql(n,e.ZERO),i=e.eql(n,e.neg(e.ONE));if(!o&&!s&&!i)throw new Error("invalid Legendre symbol result");return o?1:s?0:-1}function qs(e,t){t!==void 0&&Me(t);let r=t!==void 0?t:e.toString(2).length,n=Math.ceil(r/8);return{nBitLength:r,nByteLength:n}}function Et(e,t,r=!1,n={}){if(e<=ct)throw new Error("invalid field: expected ORDER > 0, got "+e);let o,s;if(typeof t=="object"&&t!=null){if(n.sqrt||r)throw new Error("cannot specify opts in two arguments");let f=t;f.BITS&&(o=f.BITS),f.sqrt&&(s=f.sqrt),typeof f.isLE=="boolean"&&(r=f.isLE)}else typeof t=="number"&&(o=t),n.sqrt&&(s=n.sqrt);let{nBitLength:i,nByteLength:a}=qs(e,o);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c,l=Object.freeze({ORDER:e,isLE:r,BITS:i,BYTES:a,MASK:Qt(i),ZERO:ct,ONE:X,create:f=>z(f,e),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return ct<=f&&f<e},is0:f=>f===ct,isValidNot0:f=>!l.is0(f)&&l.isValid(f),isOdd:f=>(f&X)===X,neg:f=>z(-f,e),eql:(f,u)=>f===u,sqr:f=>z(f*f,e),add:(f,u)=>z(f+u,e),sub:(f,u)=>z(f-u,e),mul:(f,u)=>z(f*u,e),pow:(f,u)=>Kc(l,f,u),div:(f,u)=>z(f*Us(u,e),e),sqrN:f=>f*f,addN:(f,u)=>f+u,subN:(f,u)=>f-u,mulN:(f,u)=>f*u,inv:f=>Us(f,e),sqrt:s||(f=>(c||(c=Oc(e)),c(l,f))),toBytes:f=>r?we(f,a):br(f,a),fromBytes:f=>{if(f.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);return r?Jt(f):ge(f)},invertBatch:f=>Ge(l,f),cmov:(f,u,x)=>x?u:f});return Object.freeze(l)}function Vs(e){if(typeof e!="bigint")throw new Error("field order must be bigint");let t=e.toString(2).length;return Math.ceil(t/8)}function Kn(e){let t=Vs(e);return t+Math.ceil(t/2)}function zs(e,t,r=!1){let n=e.length,o=Vs(t),s=Kn(t);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);let i=r?Jt(e):ge(e),a=z(i,t-X)+X;return r?we(a,o):br(a,o)}var ve=BigInt(0),ee=BigInt(1);function Se(e,t){let r=t.negate();return e?r:t}function xr(e,t,r){let n=t==="pz"?i=>i.pz:i=>i.ez,o=Ge(e.Fp,r.map(n));return r.map((i,a)=>i.toAffine(o[a])).map(e.fromAffine)}function $s(e,t){if(!Number.isSafeInteger(e)||e<=0||e>t)throw new Error("invalid window size, expected [1.."+t+"], got W="+e)}function Rn(e,t){$s(e,t);let r=Math.ceil(t/e)+1,n=2**(e-1),o=2**e,s=Qt(e),i=BigInt(e);return{windows:r,windowSize:n,mask:s,maxNumber:o,shiftBy:i}}function Fs(e,t,r){let{windowSize:n,mask:o,maxNumber:s,shiftBy:i}=r,a=Number(e&o),c=e>>i;a>n&&(a-=s,c+=ee);let l=t*n,f=l+Math.abs(a)-1,u=a===0,x=a<0,b=t%2!==0;return{nextN:c,offset:f,isZero:u,isNeg:x,isNegF:b,offsetF:l}}function Rc(e,t){if(!Array.isArray(e))throw new Error("array expected");e.forEach((r,n)=>{if(!(r instanceof t))throw new Error("invalid point at index "+n)})}function Nc(e,t){if(!Array.isArray(e))throw new Error("array of scalars expected");e.forEach((r,n)=>{if(!t.isValid(r))throw new Error("invalid scalar at index "+n)})}var Nn=new WeakMap,Zs=new WeakMap;function kn(e){return Zs.get(e)||1}function js(e){if(e!==ve)throw new Error("invalid wNAF")}function gr(e,t){return{constTimeNegate:Se,hasPrecomputes(r){return kn(r)!==1},unsafeLadder(r,n,o=e.ZERO){let s=r;for(;n>ve;)n&ee&&(o=o.add(s)),s=s.double(),n>>=ee;return o},precomputeWindow(r,n){let{windows:o,windowSize:s}=Rn(n,t),i=[],a=r,c=a;for(let l=0;l<o;l++){c=a,i.push(c);for(let f=1;f<s;f++)c=c.add(a),i.push(c);a=c.double()}return i},wNAF(r,n,o){let s=e.ZERO,i=e.BASE,a=Rn(r,t);for(let c=0;c<a.windows;c++){let{nextN:l,offset:f,isZero:u,isNeg:x,isNegF:b,offsetF:S}=Fs(o,c,a);o=l,u?i=i.add(Se(b,n[S])):s=s.add(Se(x,n[f]))}return js(o),{p:s,f:i}},wNAFUnsafe(r,n,o,s=e.ZERO){let i=Rn(r,t);for(let a=0;a<i.windows&&o!==ve;a++){let{nextN:c,offset:l,isZero:f,isNeg:u}=Fs(o,a,i);if(o=c,!f){let x=n[l];s=s.add(u?x.negate():x)}}return js(o),s},getPrecomputes(r,n,o){let s=Nn.get(n);return s||(s=this.precomputeWindow(n,r),r!==1&&(typeof o=="function"&&(s=o(s)),Nn.set(n,s))),s},wNAFCached(r,n,o){let s=kn(r);return this.wNAF(s,this.getPrecomputes(s,r,o),n)},wNAFCachedUnsafe(r,n,o,s){let i=kn(r);return i===1?this.unsafeLadder(r,n,s):this.wNAFUnsafe(i,this.getPrecomputes(i,r,o),n,s)},setWindowSize(r,n){$s(n,t),Zs.set(r,n),Nn.delete(r)}}}function Ws(e,t,r,n){let o=t,s=e.ZERO,i=e.ZERO;for(;r>ve||n>ve;)r&ee&&(s=s.add(o)),n&ee&&(i=i.add(o)),o=o.double(),r>>=ee,n>>=ee;return{p1:s,p2:i}}function wr(e,t,r,n){Rc(r,e),Nc(n,t);let o=r.length,s=n.length;if(o!==s)throw new Error("arrays of points and scalars must have equal length");let i=e.ZERO,a=Ls(BigInt(o)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let l=Qt(c),f=new Array(Number(l)+1).fill(i),u=Math.floor((t.BITS-1)/c)*c,x=i;for(let b=u;b>=0;b-=c){f.fill(i);for(let E=0;E<s;E++){let m=n[E],v=Number(m>>BigInt(b)&l);f[v]=f[v].add(r[E])}let S=i;for(let E=f.length-1,m=i;E>0;E--)m=m.add(f[E]),S=S.add(m);if(x=x.add(S),b!==0)for(let E=0;E<c;E++)x=x.double()}return x}function Gs(e,t){if(t){if(t.ORDER!==e)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Un(t),t}else return Et(e)}function Er(e,t,r={}){if(!t||typeof t!="object")throw new Error(`expected valid ${e} CURVE object`);for(let a of["p","n","h"]){let c=t[a];if(!(typeof c=="bigint"&&c>ve))throw new Error(`CURVE.${a} must be positive bigint`)}let n=Gs(t.p,r.Fp),o=Gs(t.n,r.Fn),i=["Gx","Gy","a",e==="weierstrass"?"b":"d"];for(let a of i)if(!n.isValid(t[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:o}}var Bt=BigInt(0),ft=BigInt(1),Mn=BigInt(2),kc=BigInt(8),Mc={zip215:!0};function Hc(e,t,r,n){let o=e.sqr(r),s=e.sqr(n),i=e.add(e.mul(t.a,o),s),a=e.add(e.ONE,e.mul(t.d,e.mul(o,s)));return e.eql(i,a)}function qc(e,t={}){let{Fp:r,Fn:n}=Er("edwards",e,t),{h:o,n:s}=e;Gt(t,{},{uvRatio:"function"});let i=Mn<<BigInt(n.BYTES*8)-ft,a=E=>r.create(E),c=t.uvRatio||((E,m)=>{try{return{isValid:!0,value:r.sqrt(r.div(E,m))}}catch{return{isValid:!1,value:Bt}}});if(!Hc(r,e,e.Gx,e.Gy))throw new Error("bad curve params: generator point");function l(E,m,v=!1){let T=v?ft:Bt;return jt("coordinate "+E,m,T,i),m}function f(E){if(!(E instanceof b))throw new Error("ExtendedPoint expected")}let u=Ee((E,m)=>{let{ex:v,ey:T,ez:I}=E,L=E.is0();m==null&&(m=L?kc:r.inv(I));let p=a(v*m),P=a(T*m),D=a(I*m);if(L)return{x:Bt,y:ft};if(D!==ft)throw new Error("invZ was invalid");return{x:p,y:P}}),x=Ee(E=>{let{a:m,d:v}=e;if(E.is0())throw new Error("bad point: ZERO");let{ex:T,ey:I,ez:L,et:p}=E,P=a(T*T),D=a(I*I),B=a(L*L),h=a(B*B),g=a(P*m),d=a(B*a(g+D)),y=a(h+a(v*a(P*D)));if(d!==y)throw new Error("bad point: equation left != right (1)");let w=a(T*I),_=a(L*p);if(w!==_)throw new Error("bad point: equation left != right (2)");return!0});class b{constructor(m,v,T,I){this.ex=l("x",m),this.ey=l("y",v),this.ez=l("z",T,!0),this.et=l("t",I),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(m){if(m instanceof b)throw new Error("extended point not allowed");let{x:v,y:T}=m||{};return l("x",v),l("y",T),new b(v,T,ft,a(v*T))}static normalizeZ(m){return xr(b,"ez",m)}static msm(m,v){return wr(b,n,m,v)}_setWindowSize(m){this.precompute(m)}precompute(m=8,v=!0){return S.setWindowSize(this,m),v||this.multiply(Mn),this}assertValidity(){x(this)}equals(m){f(m);let{ex:v,ey:T,ez:I}=this,{ex:L,ey:p,ez:P}=m,D=a(v*P),B=a(L*I),h=a(T*P),g=a(p*I);return D===B&&h===g}is0(){return this.equals(b.ZERO)}negate(){return new b(a(-this.ex),this.ey,this.ez,a(-this.et))}double(){let{a:m}=e,{ex:v,ey:T,ez:I}=this,L=a(v*v),p=a(T*T),P=a(Mn*a(I*I)),D=a(m*L),B=v+T,h=a(a(B*B)-L-p),g=D+p,d=g-P,y=D-p,w=a(h*d),_=a(g*y),A=a(h*y),C=a(d*g);return new b(w,_,C,A)}add(m){f(m);let{a:v,d:T}=e,{ex:I,ey:L,ez:p,et:P}=this,{ex:D,ey:B,ez:h,et:g}=m,d=a(I*D),y=a(L*B),w=a(P*T*g),_=a(p*h),A=a((I+L)*(D+B)-d-y),C=_-w,U=_+w,O=a(y-v*d),G=a(A*C),N=a(U*O),K=a(A*O),$=a(C*U);return new b(G,N,$,K)}subtract(m){return this.add(m.negate())}multiply(m){let v=m;jt("scalar",v,ft,s);let{p:T,f:I}=S.wNAFCached(this,v,b.normalizeZ);return b.normalizeZ([T,I])[0]}multiplyUnsafe(m,v=b.ZERO){let T=m;return jt("scalar",T,Bt,s),T===Bt?b.ZERO:this.is0()||T===ft?this:S.wNAFCachedUnsafe(this,T,b.normalizeZ,v)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return S.wNAFCachedUnsafe(this,s).is0()}toAffine(m){return u(this,m)}clearCofactor(){return o===ft?this:this.multiplyUnsafe(o)}static fromBytes(m,v=!1){return ot(m),this.fromHex(m,v)}static fromHex(m,v=!1){let{d:T,a:I}=e,L=r.BYTES;m=H("pointHex",m,L),Ut("zip215",v);let p=m.slice(),P=m[L-1];p[L-1]=P&-129;let D=Jt(p),B=v?i:r.ORDER;jt("pointHex.y",D,Bt,B);let h=a(D*D),g=a(h-ft),d=a(T*h-I),{isValid:y,value:w}=c(g,d);if(!y)throw new Error("Point.fromHex: invalid y coordinate");let _=(w&ft)===ft,A=(P&128)!==0;if(!v&&w===Bt&&A)throw new Error("Point.fromHex: x=0 and x_0=1");return A!==_&&(w=a(-w)),b.fromAffine({x:w,y:D})}static fromPrivateScalar(m){return b.BASE.multiply(m)}toBytes(){let{x:m,y:v}=this.toAffine(),T=we(v,r.BYTES);return T[T.length-1]|=m&ft?128:0,T}toRawBytes(){return this.toBytes()}toHex(){return At(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}b.BASE=new b(e.Gx,e.Gy,ft,a(e.Gx*e.Gy)),b.ZERO=new b(Bt,ft,ft,Bt),b.Fp=r,b.Fn=n;let S=gr(b,n.BYTES*8);return b}function Vc(e,t){Gt(t,{hash:"function"},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});let{prehash:r,hash:n}=t,{BASE:o,Fp:s,Fn:i}=e,a=i.ORDER,c=t.randomBytes||qe,l=t.adjustScalarBytes||(p=>p),f=t.domain||((p,P,D)=>{if(Ut("phflag",D),P.length||D)throw new Error("Contexts/pre-hash are not supported");return p});function u(p){return i.create(p)}function x(p){return u(Jt(p))}function b(p){let P=s.BYTES;p=H("private key",p,P);let D=H("hashed private key",n(p),2*P),B=l(D.slice(0,P)),h=D.slice(P,2*P),g=x(B);return{head:B,prefix:h,scalar:g}}function S(p){let{head:P,prefix:D,scalar:B}=b(p),h=o.multiply(B),g=h.toBytes();return{head:P,prefix:D,scalar:B,point:h,pointBytes:g}}function E(p){return S(p).pointBytes}function m(p=Uint8Array.of(),...P){let D=pt(...P);return x(n(f(D,H("context",p),!!r)))}function v(p,P,D={}){p=H("message",p),r&&(p=r(p));let{prefix:B,scalar:h,pointBytes:g}=S(P),d=m(D.context,B,p),y=o.multiply(d).toBytes(),w=m(D.context,y,g,p),_=u(d+w*h);jt("signature.s",_,Bt,a);let A=s.BYTES,C=pt(y,we(_,A));return H("result",C,A*2)}let T=Mc;function I(p,P,D,B=T){let{context:h,zip215:g}=B,d=s.BYTES;p=H("signature",p,2*d),P=H("message",P),D=H("publicKey",D,d),g!==void 0&&Ut("zip215",g),r&&(P=r(P));let y=Jt(p.slice(d,2*d)),w,_,A;try{w=e.fromHex(D,g),_=e.fromHex(p.slice(0,d),g),A=o.multiplyUnsafe(y)}catch{return!1}if(!g&&w.isSmallOrder())return!1;let C=m(h,_.toBytes(),w.toBytes(),P);return _.add(w.multiplyUnsafe(C)).subtract(A).clearCofactor().is0()}return o.precompute(8),{getPublicKey:E,sign:v,verify:I,utils:{getExtendedPublicKey:S,randomPrivateKey:()=>c(s.BYTES),precompute(p=8,P=e.BASE){return P.precompute(p,!1)}},Point:e}}function zc(e){let t={a:e.a,d:e.d,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=Et(t.n,e.nBitLength,!0),o={Fp:r,Fn:n,uvRatio:e.uvRatio},s={hash:e.hash,randomBytes:e.randomBytes,adjustScalarBytes:e.adjustScalarBytes,domain:e.domain,prehash:e.prehash,mapToCurve:e.mapToCurve};return{CURVE:t,curveOpts:o,eddsaOpts:s}}function Fc(e,t){return Object.assign({},t,{ExtendedPoint:t.Point,CURVE:e})}function Ys(e){let{CURVE:t,curveOpts:r,eddsaOpts:n}=zc(e),o=qc(t,r),s=Vc(o,n);return Fc(e,s)}var Kh=BigInt(0),jc=BigInt(1),Xs=BigInt(2),Rh=BigInt(3),Gc=BigInt(5),$c=BigInt(8),Sr={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:$c,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Zc(e){let t=BigInt(10),r=BigInt(20),n=BigInt(40),o=BigInt(80),s=Sr.p,a=e*e%s*e%s,c=q(a,Xs,s)*a%s,l=q(c,jc,s)*e%s,f=q(l,Gc,s)*l%s,u=q(f,t,s)*f%s,x=q(u,r,s)*u%s,b=q(x,n,s)*x%s,S=q(b,o,s)*b%s,E=q(S,o,s)*b%s,m=q(E,t,s)*f%s;return{pow_p_5_8:q(m,Xs,s)*e%s,b2:a}}function Wc(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}var Js=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function Yc(e,t){let r=Sr.p,n=z(t*t*t,r),o=z(n*n*t,r),s=Zc(e*o).pow_p_5_8,i=z(e*n*s,r),a=z(t*i*i,r),c=i,l=z(i*Js,r),f=a===e,u=a===z(-e,r),x=a===z(-e*Js,r);return f&&(i=c),(u||x)&&(i=l),Hs(i,r)&&(i=z(-i,r)),{isValid:f||u,value:i}}var Xc=Et(Sr.p,void 0,!0),Jc={...Sr,Fp:Xc,hash:Ts,adjustScalarBytes:Wc,uvRatio:Yc},Qs=Ys(Jc);var $e=class extends Error{constructor(t="An error occurred while verifying a message"){super(t),this.name="VerificationError"}},vr=class extends Error{constructor(t="Missing Web Crypto API"){super(t),this.name="WebCryptoMissingError"}};var ti={get(e=globalThis){let t=e.crypto;if(t?.subtle==null)throw new vr("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return t}};var bt=ti;var Ar=32;var Hn,Qc=(async()=>{try{return await bt.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();async function tf(e,t,r){if(e.buffer instanceof ArrayBuffer){let n=await bt.get().subtle.importKey("raw",e.buffer,{name:"Ed25519"},!1,["verify"]);return await bt.get().subtle.verify({name:"Ed25519"},n,t,r instanceof Uint8Array?r:r.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function ef(e,t,r){return Qs.verify(t,r instanceof Uint8Array?r:r.subarray(),e)}async function ei(e,t,r){return Hn==null&&(Hn=await Qc),Hn?tf(e,t,r):ef(e,t,r)}function Ir(e){return e==null?!1:typeof e.then=="function"&&typeof e.catch=="function"&&typeof e.finally=="function"}var Br=class{type="Ed25519";raw;constructor(t){this.raw=qn(t,Ar)}toMultihash(){return vt.digest(qt(this))}toCID(){return Z.createV1(114,this.toMultihash())}toString(){return V.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:nt(this.raw,t.raw)}verify(t,r,n){n?.signal?.throwIfAborted();let o=ei(this.raw,r,t);return Ir(o)?o.then(s=>(n?.signal?.throwIfAborted(),s)):o}};function ni(e){return e=qn(e,Ar),new Br(e)}function qn(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw new W(`Key must be a Uint8Array of length ${t}, got ${e.length}`);return e}var nf=Math.pow(2,7),of=Math.pow(2,14),sf=Math.pow(2,21),Vn=Math.pow(2,28),zn=Math.pow(2,35),Fn=Math.pow(2,42),jn=Math.pow(2,49),F=128,st=127;function _t(e){if(e<nf)return 1;if(e<of)return 2;if(e<sf)return 3;if(e<Vn)return 4;if(e<zn)return 5;if(e<Fn)return 6;if(e<jn)return 7;if(Number.MAX_SAFE_INTEGER!=null&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Ze(e,t,r=0){switch(_t(e)){case 8:t[r++]=e&255|F,e/=128;case 7:t[r++]=e&255|F,e/=128;case 6:t[r++]=e&255|F,e/=128;case 5:t[r++]=e&255|F,e/=128;case 4:t[r++]=e&255|F,e>>>=7;case 3:t[r++]=e&255|F,e>>>=7;case 2:t[r++]=e&255|F,e>>>=7;case 1:{t[r++]=e&255,e>>>=7;break}default:throw new Error("unreachable")}return t}function Gn(e,t){let r=e[t],n=0;if(n+=r&st,r<F||(r=e[t+1],n+=(r&st)<<7,r<F)||(r=e[t+2],n+=(r&st)<<14,r<F)||(r=e[t+3],n+=(r&st)<<21,r<F)||(r=e[t+4],n+=(r&st)*Vn,r<F)||(r=e[t+5],n+=(r&st)*zn,r<F)||(r=e[t+6],n+=(r&st)*Fn,r<F)||(r=e[t+7],n+=(r&st)*jn,r<F))return n;throw new RangeError("Could not decode varint")}function af(e,t){let r=e.get(t),n=0;if(n+=r&st,r<F||(r=e.get(t+1),n+=(r&st)<<7,r<F)||(r=e.get(t+2),n+=(r&st)<<14,r<F)||(r=e.get(t+3),n+=(r&st)<<21,r<F)||(r=e.get(t+4),n+=(r&st)*Vn,r<F)||(r=e.get(t+5),n+=(r&st)*zn,r<F)||(r=e.get(t+6),n+=(r&st)*Fn,r<F)||(r=e.get(t+7),n+=(r&st)*jn,r<F))return n;throw new RangeError("Could not decode varint")}function $n(e,t=0){return e instanceof Uint8Array?Gn(e,t):af(e,t)}var Zn=new Float32Array([-0]),$t=new Uint8Array(Zn.buffer);function oi(e,t,r){Zn[0]=e,t[r]=$t[0],t[r+1]=$t[1],t[r+2]=$t[2],t[r+3]=$t[3]}function si(e,t){return $t[0]=e[t],$t[1]=e[t+1],$t[2]=e[t+2],$t[3]=e[t+3],Zn[0]}var Wn=new Float64Array([-0]),it=new Uint8Array(Wn.buffer);function ii(e,t,r){Wn[0]=e,t[r]=it[0],t[r+1]=it[1],t[r+2]=it[2],t[r+3]=it[3],t[r+4]=it[4],t[r+5]=it[5],t[r+6]=it[6],t[r+7]=it[7]}function ai(e,t){return it[0]=e[t],it[1]=e[t+1],it[2]=e[t+2],it[3]=e[t+3],it[4]=e[t+4],it[5]=e[t+5],it[6]=e[t+6],it[7]=e[t+7],Wn[0]}var ff=BigInt(Number.MAX_SAFE_INTEGER),uf=BigInt(Number.MIN_SAFE_INTEGER),mt=class e{lo;hi;constructor(t,r){this.lo=t|0,this.hi=r|0}toNumber(t=!1){if(!t&&this.hi>>>31>0){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(t=!1){if(t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(t=!1){return this.toBigInt(t).toString()}zzEncode(){let t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this}zzDecode(){let t=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this}length(){let t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}static fromBigInt(t){if(t===0n)return re;if(t<ff&&t>uf)return this.fromNumber(Number(t));let r=t<0n;r&&(t=-t);let n=t>>32n,o=t-(n<<32n);return r&&(n=~n|0n,o=~o|0n,++o>ci&&(o=0n,++n>ci&&(n=0n))),new e(Number(o),Number(n))}static fromNumber(t){if(t===0)return re;let r=t<0;r&&(t=-t);let n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)}static from(t){return typeof t=="number"?e.fromNumber(t):typeof t=="bigint"?e.fromBigInt(t):typeof t=="string"?e.fromBigInt(BigInt(t)):t.low!=null||t.high!=null?new e(t.low>>>0,t.high>>>0):re}},re=new mt(0,0);re.toBigInt=function(){return 0n};re.zzEncode=re.zzDecode=function(){return this};re.length=function(){return 1};var ci=4294967296n;function fi(e){let t=0,r=0;for(let n=0;n<e.length;++n)r=e.charCodeAt(n),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(n+1)&64512)===56320?(++n,t+=4):t+=3;return t}function ui(e,t,r){if(r-t<1)return"";let o,s=[],i=0,a;for(;t<r;)a=e[t++],a<128?s[i++]=a:a>191&&a<224?s[i++]=(a&31)<<6|e[t++]&63:a>239&&a<365?(a=((a&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,s[i++]=55296+(a>>10),s[i++]=56320+(a&1023)):s[i++]=(a&15)<<12|(e[t++]&63)<<6|e[t++]&63,i>8191&&((o??(o=[])).push(String.fromCharCode.apply(String,s)),i=0);return o!=null?(i>0&&o.push(String.fromCharCode.apply(String,s.slice(0,i))),o.join("")):String.fromCharCode.apply(String,s.slice(0,i))}function Yn(e,t,r){let n=r,o,s;for(let i=0;i<e.length;++i)o=e.charCodeAt(i),o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=o&63|128):(o&64512)===55296&&((s=e.charCodeAt(i+1))&64512)===56320?(o=65536+((o&1023)<<10)+(s&1023),++i,t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=o&63|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=o&63|128);return r-n}function St(e,t){return RangeError(`index out of range: ${e.pos} + ${t??1} > ${e.len}`)}function _r(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}var Xn=class{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(t){this.buf=t,this.pos=0,this.len=t.length}uint32(){let t=4294967295;if(t=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(t=(t|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(t=(t|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return t;if((this.pos+=5)>this.len)throw this.pos=this.len,St(this,10);return t}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw St(this,4);return _r(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw St(this,4);return _r(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw St(this,4);let t=si(this.buf,this.pos);return this.pos+=4,t}double(){if(this.pos+8>this.len)throw St(this,4);let t=ai(this.buf,this.pos);return this.pos+=8,t}bytes(){let t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw St(this,t);return this.pos+=t,r===n?new Uint8Array(0):this.buf.subarray(r,n)}string(){let t=this.bytes();return ui(t,0,t.length)}skip(t){if(typeof t=="number"){if(this.pos+t>this.len)throw St(this,t);this.pos+=t}else do if(this.pos>=this.len)throw St(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${t} at offset ${this.pos}`)}return this}readLongVarint(){let t=new mt(0,0),r=0;if(this.len-this.pos>4){for(;r<4;++r)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;r=0}else{for(;r<3;++r){if(this.pos>=this.len)throw St(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<r*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<r*7)>>>0,t}if(this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw St(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<r*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw St(this,8);let t=_r(this.buf,this.pos+=4),r=_r(this.buf,this.pos+=4);return new mt(t,r)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){let t=Gn(this.buf,this.pos);return this.pos+=_t(t),t}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Jn(e){return new Xn(e instanceof Uint8Array?e:e.subarray())}function Ae(e,t,r){let n=Jn(e);return t.decode(n,void 0,r)}function Qn(e){let t=e??8192,r=t>>>1,n,o=t;return function(i){if(i<1||i>r)return ht(i);o+i>t&&(n=ht(t),o=0);let a=n.subarray(o,o+=i);return(o&7)!==0&&(o=(o|7)+1),a}}var ne=class{fn;len;next;val;constructor(t,r,n){this.fn=t,this.len=r,this.next=void 0,this.val=n}};function to(){}var ro=class{head;tail;len;next;constructor(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}},lf=Qn();function hf(e){return globalThis.Buffer!=null?ht(e):lf(e)}var Ye=class{len;head;tail;states;constructor(){this.len=0,this.head=new ne(to,0,0),this.tail=this.head,this.states=null}_push(t,r,n){return this.tail=this.tail.next=new ne(t,r,n),this.len+=r,this}uint32(t){return this.len+=(this.tail=this.tail.next=new no((t=t>>>0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this}int32(t){return t<0?this._push(Cr,10,mt.fromNumber(t)):this.uint32(t)}sint32(t){return this.uint32((t<<1^t>>31)>>>0)}uint64(t){let r=mt.fromBigInt(t);return this._push(Cr,r.length(),r)}uint64Number(t){return this._push(Ze,_t(t),t)}uint64String(t){return this.uint64(BigInt(t))}int64(t){return this.uint64(t)}int64Number(t){return this.uint64Number(t)}int64String(t){return this.uint64String(t)}sint64(t){let r=mt.fromBigInt(t).zzEncode();return this._push(Cr,r.length(),r)}sint64Number(t){let r=mt.fromNumber(t).zzEncode();return this._push(Cr,r.length(),r)}sint64String(t){return this.sint64(BigInt(t))}bool(t){return this._push(eo,1,t?1:0)}fixed32(t){return this._push(We,4,t>>>0)}sfixed32(t){return this.fixed32(t)}fixed64(t){let r=mt.fromBigInt(t);return this._push(We,4,r.lo)._push(We,4,r.hi)}fixed64Number(t){let r=mt.fromNumber(t);return this._push(We,4,r.lo)._push(We,4,r.hi)}fixed64String(t){return this.fixed64(BigInt(t))}sfixed64(t){return this.fixed64(t)}sfixed64Number(t){return this.fixed64Number(t)}sfixed64String(t){return this.fixed64String(t)}float(t){return this._push(oi,4,t)}double(t){return this._push(ii,8,t)}bytes(t){let r=t.length>>>0;return r===0?this._push(eo,1,0):this.uint32(r)._push(pf,r,t)}string(t){let r=fi(t);return r!==0?this.uint32(r)._push(Yn,r,t):this._push(eo,1,0)}fork(){return this.states=new ro(this),this.head=this.tail=new ne(to,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ne(to,0,0),this.len=0),this}ldelim(){let t=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=t.next,this.tail=r,this.len+=n),this}finish(){let t=this.head.next,r=hf(this.len),n=0;for(;t!=null;)t.fn(t.val,r,n),n+=t.len,t=t.next;return r}};function eo(e,t,r){t[r]=e&255}function df(e,t,r){for(;e>127;)t[r++]=e&127|128,e>>>=7;t[r]=e}var no=class extends ne{next;constructor(t,r){super(df,t,r),this.next=void 0}};function Cr(e,t,r){for(;e.hi!==0;)t[r++]=e.lo&127|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=e.lo&127|128,e.lo=e.lo>>>7;t[r++]=e.lo}function We(e,t,r){t[r]=e&255,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function pf(e,t,r){t.set(e,r)}globalThis.Buffer!=null&&(Ye.prototype.bytes=function(e){let t=e.length>>>0;return this.uint32(t),t>0&&this._push(mf,t,e),this},Ye.prototype.string=function(e){let t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(yf,t,e),this});function mf(e,t,r){t.set(e,r)}function yf(e,t,r){e.length<40?Yn(e,t,r):t.utf8Write!=null?t.utf8Write(e,r):t.set(k(e),r)}function oo(){return new Ye}function Ie(e,t){let r=oo();return t.encode(e,r,{lengthDelimited:!1}),r.finish()}var Be;(function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"})(Be||(Be={}));function Tr(e,t,r,n){return{name:e,type:t,encode:r,decode:n}}function so(e){function t(o){if(e[o.toString()]==null)throw new Error("Invalid enum value");return e[o]}let r=function(s,i){let a=t(s);i.int32(a)},n=function(s){let i=s.int32();return t(i)};return Tr("enum",Be.VARINT,r,n)}function _e(e,t){return Tr("message",Be.LENGTH_DELIMITED,e,t)}var Dr=class extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"};var J;(function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.secp256k1="secp256k1",e.ECDSA="ECDSA"})(J||(J={}));var io;(function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.secp256k1=2]="secp256k1",e[e.ECDSA=3]="ECDSA"})(io||(io={}));(function(e){e.codec=()=>so(io)})(J||(J={}));var Kt;(function(e){let t;e.codec=()=>(t==null&&(t=_e((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),J.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=J.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>Ie(r,e.codec()),e.decode=(r,n)=>Ae(r,e.codec(),n)})(Kt||(Kt={}));var ao;(function(e){let t;e.codec=()=>(t==null&&(t=_e((r,n,o={})=>{o.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),J.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.Type=J.codec().decode(r);break}case 2:{s.Data=r.bytes();break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>Ie(r,e.codec()),e.decode=(r,n)=>Ae(r,e.codec(),n)})(ao||(ao={}));var Je={};ut(Je,{MAX_RSA_KEY_SIZE:()=>co,generateRSAKeyPair:()=>yi,jwkToJWKKeyPair:()=>bi,jwkToPkcs1:()=>wf,jwkToPkix:()=>ho,jwkToRSAPrivateKey:()=>bo,pkcs1MessageToJwk:()=>uo,pkcs1MessageToRSAPrivateKey:()=>po,pkcs1ToJwk:()=>gf,pkcs1ToRSAPrivateKey:()=>mi,pkixMessageToJwk:()=>lo,pkixMessageToRSAPublicKey:()=>yo,pkixToJwk:()=>Ef,pkixToRSAPublicKey:()=>mo});var Pr=yr;var Ce=class{type="RSA";jwk;_raw;_multihash;constructor(t,r){this.jwk=t,this._multihash=r}get raw(){return this._raw==null&&(this._raw=Je.jwkToPkix(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return Z.createV1(114,this._multihash)}toString(){return V.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:nt(this.raw,t.raw)}verify(t,r,n){return pi(this.jwk,r,t,n)}},Xe=class{type="RSA";jwk;_raw;publicKey;constructor(t,r){this.jwk=t,this.publicKey=r}get raw(){return this._raw==null&&(this._raw=Je.jwkToPkcs1(this.jwk)),this._raw}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:nt(this.raw,t.raw)}sign(t,r){return di(this.jwk,t,r)}};var co=8192,fo=18,bf=1062,xf=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function gf(e){let t=Dt(e);return uo(t)}function uo(e){return{n:R(e[1],"base64url"),e:R(e[2],"base64url"),d:R(e[3],"base64url"),p:R(e[4],"base64url"),q:R(e[5],"base64url"),dp:R(e[6],"base64url"),dq:R(e[7],"base64url"),qi:R(e[8],"base64url"),kty:"RSA"}}function wf(e){if(e.n==null||e.e==null||e.d==null||e.p==null||e.q==null||e.dp==null||e.dq==null||e.qi==null)throw new W("JWK was missing components");return Ht([lt(Uint8Array.from([0])),lt(k(e.n,"base64url")),lt(k(e.e,"base64url")),lt(k(e.d,"base64url")),lt(k(e.p,"base64url")),lt(k(e.q,"base64url")),lt(k(e.dp,"base64url")),lt(k(e.dq,"base64url")),lt(k(e.qi,"base64url"))]).subarray()}function Ef(e){let t=Dt(e,{offset:0});return lo(t)}function lo(e){let t=Dt(e[1],{offset:0});return{kty:"RSA",n:R(t[0],"base64url"),e:R(t[1],"base64url")}}function ho(e){if(e.n==null||e.e==null)throw new W("JWK was missing components");return Ht([xf,hr(Ht([lt(k(e.n,"base64url")),lt(k(e.e,"base64url"))]))]).subarray()}function mi(e){let t=Dt(e);return po(t)}function po(e){let t=uo(e);return bo(t)}function mo(e,t){if(e.byteLength>=bf)throw new ae("Key size is too large");let r=Dt(e,{offset:0});return yo(r,e,t)}function yo(e,t,r){let n=lo(e);if(r==null){let o=Pr(Kt.encode({Type:J.RSA,Data:t}));r=xt(fo,o)}return new Ce(n,r)}function bo(e){if(gi(e)>co)throw new W("Key size is too large");let t=bi(e),r=Pr(Kt.encode({Type:J.RSA,Data:ho(t.publicKey)})),n=xt(fo,r);return new Xe(t.privateKey,new Ce(t.publicKey,n))}async function yi(e){if(e>co)throw new W("Key size is too large");let t=await xi(e),r=Pr(Kt.encode({Type:J.RSA,Data:ho(t.publicKey)})),n=xt(fo,r);return new Xe(t.privateKey,new Ce(t.publicKey,n))}function bi(e){if(e==null)throw new W("Missing key parameter");return{privateKey:e,publicKey:{kty:e.kty,n:e.n,e:e.e}}}async function xi(e,t){let r=await bt.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);t?.signal?.throwIfAborted();let n=await Sf(r,t);return{privateKey:n[0],publicKey:n[1]}}async function di(e,t,r){let n=await bt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);r?.signal?.throwIfAborted();let o=await bt.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return r?.signal?.throwIfAborted(),new Uint8Array(o,0,o.byteLength)}async function pi(e,t,r,n){let o=await bt.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();let s=await bt.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},o,t,r instanceof Uint8Array?r:r.subarray());return n?.signal?.throwIfAborted(),s}async function Sf(e,t){if(e.privateKey==null||e.publicKey==null)throw new W("Private and public key are required");let r=await Promise.all([bt.get().subtle.exportKey("jwk",e.privateKey),bt.get().subtle.exportKey("jwk",e.publicKey)]);return t?.signal?.throwIfAborted(),r}function gi(e){if(e.kty!=="RSA")throw new W("invalid key type");if(e.n==null)throw new W("invalid key modulus");return k(e.n,"base64url").length*8}var Lr=class extends me{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,ps(t);let n=He(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let o=this.blockLen,s=new Uint8Array(o);s.set(n.length>o?t.create().update(n).digest():n);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),Lt(s)}update(t){return be(this),this.iHash.update(t),this}digestInto(t){be(this),ot(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){let t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:n,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=a,t.oHash=r._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},xo=(e,t,r)=>new Lr(e,t).update(r).digest();xo.create=(e,t)=>new Lr(e,t);function wi(e){e.lowS!==void 0&&Ut("lowS",e.lowS),e.prehash!==void 0&&Ut("prehash",e.prehash)}var go=class extends Error{constructor(t=""){super(t)}},Rt={Err:go,_tlv:{encode:(e,t)=>{let{Err:r}=Rt;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length&1)throw new r("tlv.encode: unpadded data");let n=t.length/2,o=je(n);if(o.length/2&128)throw new r("tlv.encode: long form length too big");let s=n>127?je(o.length/2|128):"";return je(e)+s+o+t},decode(e,t){let{Err:r}=Rt,n=0;if(e<0||e>256)throw new r("tlv.encode: wrong tag");if(t.length<2||t[n++]!==e)throw new r("tlv.decode: wrong tlv");let o=t[n++],s=!!(o&128),i=0;if(!s)i=o;else{let c=o&127;if(!c)throw new r("tlv.decode(long): indefinite length not supported");if(c>4)throw new r("tlv.decode(long): byte length is too big");let l=t.subarray(n,n+c);if(l.length!==c)throw new r("tlv.decode: length bytes not complete");if(l[0]===0)throw new r("tlv.decode(long): zero leftmost byte");for(let f of l)i=i<<8|f;if(n+=c,i<128)throw new r("tlv.decode(long): not minimal encoding")}let a=t.subarray(n,n+i);if(a.length!==i)throw new r("tlv.decode: wrong value length");return{v:a,l:t.subarray(n+i)}}},_int:{encode(e){let{Err:t}=Rt;if(e<Qe)throw new t("integer: negative integers are not allowed");let r=je(e);if(Number.parseInt(r[0],16)&8&&(r="00"+r),r.length&1)throw new t("unexpected DER parsing assertion: unpadded hex");return r},decode(e){let{Err:t}=Rt;if(e[0]&128)throw new t("invalid signature integer: negative");if(e[0]===0&&!(e[1]&128))throw new t("invalid signature integer: unnecessary leading zero");return ge(e)}},toSig(e){let{Err:t,_int:r,_tlv:n}=Rt,o=H("signature",e),{v:s,l:i}=n.decode(48,o);if(i.length)throw new t("invalid signature: left bytes after parsing");let{v:a,l:c}=n.decode(2,s),{v:l,l:f}=n.decode(2,c);if(f.length)throw new t("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(e){let{_tlv:t,_int:r}=Rt,n=t.encode(2,r.encode(e.r)),o=t.encode(2,r.encode(e.s)),s=n+o;return t.encode(48,s)}},Qe=BigInt(0),tr=BigInt(1),vf=BigInt(2),Or=BigInt(3),Af=BigInt(4);function If(e,t,r){function n(o){let s=e.sqr(o),i=e.mul(s,o);return e.add(e.add(i,e.mul(o,t)),r)}return n}function Ei(e,t,r){let{BYTES:n}=e;function o(s){let i;if(typeof s=="bigint")i=s;else{let a=H("private key",s);if(t){if(!t.includes(a.length*2))throw new Error("invalid private key");let c=new Uint8Array(n);c.set(a,c.length-a.length),a=c}try{i=e.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof s}`)}}if(r&&(i=e.create(i)),!e.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}return o}function Bf(e,t={}){let{Fp:r,Fn:n}=Er("weierstrass",e,t),{h:o,n:s}=e;Gt(t,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:i}=t;if(i&&(!r.is0(e.a)||typeof i.beta!="bigint"||typeof i.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(B,h,g){let{x:d,y}=h.toAffine(),w=r.toBytes(d);if(Ut("isCompressed",g),g){a();let _=!r.isOdd(y);return pt(Si(_),w)}else return pt(Uint8Array.of(4),w,r.toBytes(y))}function l(B){ot(B);let h=r.BYTES,g=h+1,d=2*h+1,y=B.length,w=B[0],_=B.subarray(1);if(y===g&&(w===2||w===3)){let A=r.fromBytes(_);if(!r.isValid(A))throw new Error("bad point: is not on curve, wrong x");let C=x(A),U;try{U=r.sqrt(C)}catch(N){let K=N instanceof Error?": "+N.message:"";throw new Error("bad point: is not on curve, sqrt error"+K)}a();let O=r.isOdd(U);return(w&1)===1!==O&&(U=r.neg(U)),{x:A,y:U}}else if(y===d&&w===4){let A=r.fromBytes(_.subarray(h*0,h*1)),C=r.fromBytes(_.subarray(h*1,h*2));if(!b(A,C))throw new Error("bad point: is not on curve");return{x:A,y:C}}else throw new Error(`bad point: got length ${y}, expected compressed=${g} or uncompressed=${d}`)}let f=t.toBytes||c,u=t.fromBytes||l,x=If(r,e.a,e.b);function b(B,h){let g=r.sqr(h),d=x(B);return r.eql(g,d)}if(!b(e.Gx,e.Gy))throw new Error("bad curve params: generator point");let S=r.mul(r.pow(e.a,Or),Af),E=r.mul(r.sqr(e.b),BigInt(27));if(r.is0(r.add(S,E)))throw new Error("bad curve params: a or b");function m(B,h,g=!1){if(!r.isValid(h)||g&&r.is0(h))throw new Error(`bad point coordinate ${B}`);return h}function v(B){if(!(B instanceof p))throw new Error("ProjectivePoint expected")}let T=Ee((B,h)=>{let{px:g,py:d,pz:y}=B;if(r.eql(y,r.ONE))return{x:g,y:d};let w=B.is0();h==null&&(h=w?r.ONE:r.inv(y));let _=r.mul(g,h),A=r.mul(d,h),C=r.mul(y,h);if(w)return{x:r.ZERO,y:r.ZERO};if(!r.eql(C,r.ONE))throw new Error("invZ was invalid");return{x:_,y:A}}),I=Ee(B=>{if(B.is0()){if(t.allowInfinityPoint&&!r.is0(B.py))return;throw new Error("bad point: ZERO")}let{x:h,y:g}=B.toAffine();if(!r.isValid(h)||!r.isValid(g))throw new Error("bad point: x or y not field elements");if(!b(h,g))throw new Error("bad point: equation left != right");if(!B.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function L(B,h,g,d,y){return g=new p(r.mul(g.px,B),g.py,g.pz),h=Se(d,h),g=Se(y,g),h.add(g)}class p{constructor(h,g,d){this.px=m("x",h),this.py=m("y",g,!0),this.pz=m("z",d),Object.freeze(this)}static fromAffine(h){let{x:g,y:d}=h||{};if(!h||!r.isValid(g)||!r.isValid(d))throw new Error("invalid affine point");if(h instanceof p)throw new Error("projective point not allowed");return r.is0(g)&&r.is0(d)?p.ZERO:new p(g,d,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(h){return xr(p,"pz",h)}static fromBytes(h){return ot(h),p.fromHex(h)}static fromHex(h){let g=p.fromAffine(u(H("pointHex",h)));return g.assertValidity(),g}static fromPrivateKey(h){let g=Ei(n,t.allowedPrivateKeyLengths,t.wrapPrivateKey);return p.BASE.multiply(g(h))}static msm(h,g){return wr(p,n,h,g)}precompute(h=8,g=!0){return D.setWindowSize(this,h),g||this.multiply(Or),this}_setWindowSize(h){this.precompute(h)}assertValidity(){I(this)}hasEvenY(){let{y:h}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(h)}equals(h){v(h);let{px:g,py:d,pz:y}=this,{px:w,py:_,pz:A}=h,C=r.eql(r.mul(g,A),r.mul(w,y)),U=r.eql(r.mul(d,A),r.mul(_,y));return C&&U}negate(){return new p(this.px,r.neg(this.py),this.pz)}double(){let{a:h,b:g}=e,d=r.mul(g,Or),{px:y,py:w,pz:_}=this,A=r.ZERO,C=r.ZERO,U=r.ZERO,O=r.mul(y,y),G=r.mul(w,w),N=r.mul(_,_),K=r.mul(y,w);return K=r.add(K,K),U=r.mul(y,_),U=r.add(U,U),A=r.mul(h,U),C=r.mul(d,N),C=r.add(A,C),A=r.sub(G,C),C=r.add(G,C),C=r.mul(A,C),A=r.mul(K,A),U=r.mul(d,U),N=r.mul(h,N),K=r.sub(O,N),K=r.mul(h,K),K=r.add(K,U),U=r.add(O,O),O=r.add(U,O),O=r.add(O,N),O=r.mul(O,K),C=r.add(C,O),N=r.mul(w,_),N=r.add(N,N),O=r.mul(N,K),A=r.sub(A,O),U=r.mul(N,G),U=r.add(U,U),U=r.add(U,U),new p(A,C,U)}add(h){v(h);let{px:g,py:d,pz:y}=this,{px:w,py:_,pz:A}=h,C=r.ZERO,U=r.ZERO,O=r.ZERO,G=e.a,N=r.mul(e.b,Or),K=r.mul(g,w),$=r.mul(d,_),Y=r.mul(y,A),rt=r.add(g,d),M=r.add(w,_);rt=r.mul(rt,M),M=r.add(K,$),rt=r.sub(rt,M),M=r.add(g,y);let at=r.add(w,A);return M=r.mul(M,at),at=r.add(K,Y),M=r.sub(M,at),at=r.add(d,y),C=r.add(_,A),at=r.mul(at,C),C=r.add($,Y),at=r.sub(at,C),O=r.mul(G,M),C=r.mul(N,Y),O=r.add(C,O),C=r.sub($,O),O=r.add($,O),U=r.mul(C,O),$=r.add(K,K),$=r.add($,K),Y=r.mul(G,Y),M=r.mul(N,M),$=r.add($,Y),Y=r.sub(K,Y),Y=r.mul(G,Y),M=r.add(M,Y),K=r.mul($,M),U=r.add(U,K),K=r.mul(at,M),C=r.mul(rt,C),C=r.sub(C,K),K=r.mul(rt,$),O=r.mul(at,O),O=r.add(O,K),new p(C,U,O)}subtract(h){return this.add(h.negate())}is0(){return this.equals(p.ZERO)}multiply(h){let{endo:g}=t;if(!n.isValidNot0(h))throw new Error("invalid scalar: out of range");let d,y,w=_=>D.wNAFCached(this,_,p.normalizeZ);if(g){let{k1neg:_,k1:A,k2neg:C,k2:U}=g.splitScalar(h),{p:O,f:G}=w(A),{p:N,f:K}=w(U);y=G.add(K),d=L(g.beta,O,N,_,C)}else{let{p:_,f:A}=w(h);d=_,y=A}return p.normalizeZ([d,y])[0]}multiplyUnsafe(h){let{endo:g}=t,d=this;if(!n.isValid(h))throw new Error("invalid scalar: out of range");if(h===Qe||d.is0())return p.ZERO;if(h===tr)return d;if(D.hasPrecomputes(this))return this.multiply(h);if(g){let{k1neg:y,k1:w,k2neg:_,k2:A}=g.splitScalar(h),{p1:C,p2:U}=Ws(p,d,w,A);return L(g.beta,C,U,y,_)}else return D.wNAFCachedUnsafe(d,h)}multiplyAndAddUnsafe(h,g,d){let y=this.multiplyUnsafe(g).add(h.multiplyUnsafe(d));return y.is0()?void 0:y}toAffine(h){return T(this,h)}isTorsionFree(){let{isTorsionFree:h}=t;return o===tr?!0:h?h(p,this):D.wNAFCachedUnsafe(this,s).is0()}clearCofactor(){let{clearCofactor:h}=t;return o===tr?this:h?h(p,this):this.multiplyUnsafe(o)}toBytes(h=!0){return Ut("isCompressed",h),this.assertValidity(),f(p,this,h)}toRawBytes(h=!0){return this.toBytes(h)}toHex(h=!0){return At(this.toBytes(h))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}p.BASE=new p(e.Gx,e.Gy,r.ONE),p.ZERO=new p(r.ZERO,r.ONE,r.ZERO),p.Fp=r,p.Fn=n;let P=n.BITS,D=gr(p,t.endo?Math.ceil(P/2):P);return p}function Si(e){return Uint8Array.of(e?2:3)}function _f(e,t,r={}){Gt(t,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let n=t.randomBytes||qe,o=t.hmac||((d,...y)=>xo(t.hash,d,pt(...y))),{Fp:s,Fn:i}=e,{ORDER:a,BITS:c}=i;function l(d){let y=a>>tr;return d>y}function f(d){return l(d)?i.neg(d):d}function u(d,y){if(!i.isValidNot0(y))throw new Error(`invalid signature ${d}: out of range 1..CURVE.n`)}class x{constructor(y,w,_){u("r",y),u("s",w),this.r=y,this.s=w,_!=null&&(this.recovery=_),Object.freeze(this)}static fromCompact(y){let w=i.BYTES,_=H("compactSignature",y,w*2);return new x(i.fromBytes(_.subarray(0,w)),i.fromBytes(_.subarray(w,w*2)))}static fromDER(y){let{r:w,s:_}=Rt.toSig(H("DER",y));return new x(w,_)}assertValidity(){}addRecoveryBit(y){return new x(this.r,this.s,y)}recoverPublicKey(y){let w=s.ORDER,{r:_,s:A,recovery:C}=this;if(C==null||![0,1,2,3].includes(C))throw new Error("recovery id invalid");if(a*vf<w&&C>1)throw new Error("recovery id is ambiguous for h>1 curve");let O=C===2||C===3?_+a:_;if(!s.isValid(O))throw new Error("recovery id 2 or 3 invalid");let G=s.toBytes(O),N=e.fromHex(pt(Si((C&1)===0),G)),K=i.inv(O),$=I(H("msgHash",y)),Y=i.create(-$*K),rt=i.create(A*K),M=e.BASE.multiplyUnsafe(Y).add(N.multiplyUnsafe(rt));if(M.is0())throw new Error("point at infinify");return M.assertValidity(),M}hasHighS(){return l(this.s)}normalizeS(){return this.hasHighS()?new x(this.r,i.neg(this.s),this.recovery):this}toBytes(y){if(y==="compact")return pt(i.toBytes(this.r),i.toBytes(this.s));if(y==="der")return xe(Rt.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return At(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return At(this.toBytes("compact"))}}let b=Ei(i,r.allowedPrivateKeyLengths,r.wrapPrivateKey),S={isValidPrivateKey(d){try{return b(d),!0}catch{return!1}},normPrivateKeyToScalar:b,randomPrivateKey:()=>{let d=a;return zs(n(Kn(d)),d)},precompute(d=8,y=e.BASE){return y.precompute(d,!1)}};function E(d,y=!0){return e.fromPrivateKey(d).toBytes(y)}function m(d){if(typeof d=="bigint")return!1;if(d instanceof e)return!0;let w=H("key",d).length,_=s.BYTES,A=_+1,C=2*_+1;if(!(r.allowedPrivateKeyLengths||i.BYTES===A))return w===A||w===C}function v(d,y,w=!0){if(m(d)===!0)throw new Error("first arg must be private key");if(m(y)===!1)throw new Error("second arg must be public key");return e.fromHex(y).multiply(b(d)).toBytes(w)}let T=t.bits2int||function(d){if(d.length>8192)throw new Error("input is too large");let y=ge(d),w=d.length*8-c;return w>0?y>>BigInt(w):y},I=t.bits2int_modN||function(d){return i.create(T(d))},L=Qt(c);function p(d){return jt("num < 2^"+c,d,Qe,L),i.toBytes(d)}function P(d,y,w=D){if(["recovered","canonical"].some(rt=>rt in w))throw new Error("sign() legacy options not supported");let{hash:_}=t,{lowS:A,prehash:C,extraEntropy:U}=w;A==null&&(A=!0),d=H("msgHash",d),wi(w),C&&(d=H("prehashed msgHash",_(d)));let O=I(d),G=b(y),N=[p(G),p(O)];if(U!=null&&U!==!1){let rt=U===!0?n(s.BYTES):U;N.push(H("extraEntropy",rt))}let K=pt(...N),$=O;function Y(rt){let M=T(rt);if(!i.isValidNot0(M))return;let at=i.inv(M),Pe=e.BASE.multiply(M).toAffine(),se=i.create(Pe.x);if(se===Qe)return;let Zt=i.create(at*i.create($+se*G));if(Zt===Qe)return;let Wr=(Pe.x===se?0:2)|Number(Pe.y&tr),ie=Zt;return A&&l(Zt)&&(ie=f(Zt),Wr^=1),new x(se,ie,Wr)}return{seed:K,k2sig:Y}}let D={lowS:t.lowS,prehash:!1},B={lowS:t.lowS,prehash:!1};function h(d,y,w=D){let{seed:_,k2sig:A}=P(d,y,w);return Os(t.hash.outputLen,i.BYTES,o)(_,A)}e.BASE.precompute(8);function g(d,y,w,_=B){let A=d;y=H("msgHash",y),w=H("publicKey",w),wi(_);let{lowS:C,prehash:U,format:O}=_;if("strict"in _)throw new Error("options.strict was renamed to lowS");if(O!==void 0&&!["compact","der","js"].includes(O))throw new Error('format must be "compact", "der" or "js"');let G=typeof A=="string"||ye(A),N=!G&&!O&&typeof A=="object"&&A!==null&&typeof A.r=="bigint"&&typeof A.s=="bigint";if(!G&&!N)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let K,$;try{if(N)if(O===void 0||O==="js")K=new x(A.r,A.s);else throw new Error("invalid format");if(G){try{O!=="compact"&&(K=x.fromDER(A))}catch(ie){if(!(ie instanceof Rt.Err))throw ie}!K&&O!=="der"&&(K=x.fromCompact(A))}$=e.fromHex(w)}catch{return!1}if(!K||C&&K.hasHighS())return!1;U&&(y=t.hash(y));let{r:Y,s:rt}=K,M=I(y),at=i.inv(rt),Pe=i.create(M*at),se=i.create(Y*at),Zt=e.BASE.multiplyUnsafe(Pe).add($.multiplyUnsafe(se));return Zt.is0()?!1:i.create(Zt.x)===Y}return Object.freeze({getPublicKey:E,getSharedSecret:v,sign:h,verify:g,utils:S,Point:e,Signature:x})}function Cf(e){let t={a:e.a,b:e.b,p:e.Fp.ORDER,n:e.n,h:e.h,Gx:e.Gx,Gy:e.Gy},r=e.Fp,n=Et(t.n,e.nBitLength),o={Fp:r,Fn:n,allowedPrivateKeyLengths:e.allowedPrivateKeyLengths,allowInfinityPoint:e.allowInfinityPoint,endo:e.endo,wrapPrivateKey:e.wrapPrivateKey,isTorsionFree:e.isTorsionFree,clearCofactor:e.clearCofactor,fromBytes:e.fromBytes,toBytes:e.toBytes};return{CURVE:t,curveOpts:o}}function Tf(e){let{CURVE:t,curveOpts:r}=Cf(e),n={hash:e.hash,hmac:e.hmac,randomBytes:e.randomBytes,lowS:e.lowS,bits2int:e.bits2int,bits2int_modN:e.bits2int_modN};return{CURVE:t,curveOpts:r,ecdsaOpts:n}}function Df(e,t){return Object.assign({},t,{ProjectivePoint:t.Point,CURVE:e})}function vi(e){let{CURVE:t,curveOpts:r,ecdsaOpts:n}=Tf(e),o=Bf(t,r),s=_f(o,n,r);return Df(e,s)}function Ai(e,t){let r=n=>vi({...e,hash:n});return{...r(t),create:r}}var Ur={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Sp=BigInt(0),Pf=BigInt(1),wo=BigInt(2),Ii=(e,t)=>(e+t/wo)/t;function Lf(e){let t=Ur.p,r=BigInt(3),n=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),l=e*e*e%t,f=l*l*e%t,u=q(f,r,t)*f%t,x=q(u,r,t)*f%t,b=q(x,wo,t)*l%t,S=q(b,o,t)*b%t,E=q(S,s,t)*S%t,m=q(E,a,t)*E%t,v=q(m,c,t)*m%t,T=q(v,a,t)*E%t,I=q(T,r,t)*f%t,L=q(I,i,t)*S%t,p=q(L,n,t)*l%t,P=q(p,wo,t);if(!Eo.eql(Eo.sqr(P),e))throw new Error("Cannot find square root");return P}var Eo=Et(Ur.p,void 0,void 0,{sqrt:Lf}),Te=Ai({...Ur,Fp:Eo,lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{let t=Ur.n,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Pf*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,i=BigInt("0x100000000000000000000000000000000"),a=Ii(s*e,t),c=Ii(-n*e,t),l=z(e-a*r-c*o,t),f=z(-a*n-c*s,t),u=l>i,x=f>i;if(u&&(l=t-l),x&&(f=t-f),l>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:u,k1:l,k2neg:x,k2:f}}}},yr);function Bi(e,t,r,n){let o=ur.digest(r instanceof Uint8Array?r:r.subarray());if(Ir(o))return o.then(({digest:s})=>(n?.signal?.throwIfAborted(),Te.verify(t,s,e))).catch(s=>{throw s.name==="AbortError"?s:new $e(String(s))});try{return n?.signal?.throwIfAborted(),Te.verify(t,o.digest,e)}catch(s){throw new $e(String(s))}}var Kr=class{type="secp256k1";raw;_key;constructor(t){this._key=Ci(t),this.raw=_i(this._key)}toMultihash(){return vt.digest(qt(this))}toCID(){return Z.createV1(114,this.toMultihash())}toString(){return V.encode(this.toMultihash().bytes).substring(1)}equals(t){return t==null||!(t.raw instanceof Uint8Array)?!1:nt(this.raw,t.raw)}verify(t,r,n){return Bi(this._key,r,t,n)}};function Ti(e){return new Kr(e)}function _i(e){return Te.ProjectivePoint.fromHex(e).toRawBytes(!0)}function Ci(e){try{return Te.ProjectivePoint.fromHex(e),e}catch(t){throw new ae(String(t))}}function Di(e,t){let{Type:r,Data:n}=Kt.decode(e),o=n??new Uint8Array;switch(r){case J.RSA:return mo(o,t);case J.Ed25519:return ni(o);case J.secp256k1:return Ti(o);case J.ECDSA:return us(o);default:throw new ce}}function qt(e){return Kt.encode({Type:J[e.type],Data:e.raw})}var Pi=Symbol.for("nodejs.util.inspect.custom"),Of=114,er=class{type;multihash;publicKey;string;constructor(t){this.type=t.type,this.multihash=t.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[Xr]=!0;toString(){return this.string==null&&(this.string=V.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Z.createV1(Of,this.multihash)}toJSON(){return this.toString()}equals(t){if(t==null)return!1;if(t instanceof Uint8Array)return nt(this.multihash.bytes,t);if(typeof t=="string")return this.toString()===t;if(t?.toMultihash()?.bytes!=null)return nt(this.multihash.bytes,t.toMultihash().bytes);throw new Error("not valid Id")}[Pi](){return`PeerId(${this.toString()})`}},Rr=class extends er{type="RSA";publicKey;constructor(t){super({...t,type:"RSA"}),this.publicKey=t.publicKey}},Nr=class extends er{type="Ed25519";publicKey;constructor(t){super({...t,type:"Ed25519"}),this.publicKey=t.publicKey}},kr=class extends er{type="secp256k1";publicKey;constructor(t){super({...t,type:"secp256k1"}),this.publicKey=t.publicKey}},Uf=2336,So=class{type="url";multihash;publicKey;url;constructor(t){this.url=t.toString(),this.multihash=vt.digest(k(this.url))}[Pi](){return`PeerId(${this.url})`}[Xr]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Z.createV1(Uf,this.toMultihash())}toJSON(){return this.toString()}equals(t){return t==null?!1:(t instanceof Uint8Array&&(t=R(t)),t.toString()===this.toString())}};function Li(e){if(e.type==="Ed25519")return new Nr({multihash:e.toCID().multihash,publicKey:e});if(e.type==="secp256k1")return new kr({multihash:e.toCID().multihash,publicKey:e});if(e.type==="RSA")return new Rr({multihash:e.toCID().multihash,publicKey:e});throw new ce}var tt=class extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"},Nt=class extends Error{static name="ValidationError";name="ValidationError"},rr=class extends Error{static name="InvalidParametersError";name="InvalidParametersError"},Mr=class extends Error{static name="InvalidProtocolError";name="InvalidProtocolError"};var Hr=class{index=0;input="";new(t){return this.index=0,this.input=t,this}readAtomically(t){let r=this.index,n=t();return n===void 0&&(this.index=r),n}parseWith(t){let r=t();if(this.index===this.input.length)return r}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically(()=>{let r=this.readChar();if(r===t)return r})}readSeparator(t,r,n){return this.readAtomically(()=>{if(!(r>0&&this.readGivenChar(t)===void 0))return n()})}readNumber(t,r,n,o){return this.readAtomically(()=>{let s=0,i=0,a=this.peekChar();if(a===void 0)return;let c=a==="0",l=2**(8*o)-1;for(;;){let f=this.readAtomically(()=>{let u=this.readChar();if(u===void 0)return;let x=Number.parseInt(u,t);if(!Number.isNaN(x))return x});if(f===void 0)break;if(s*=t,s+=f,s>l||(i+=1,r!==void 0&&i>r))return}if(i!==0)return!n&&c&&i>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{let t=new Uint8Array(4);for(let r=0;r<t.length;r++){let n=this.readSeparator(".",r,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;t[r]=n}return t})}readIPv6Addr(){let t=r=>{for(let n=0;n<r.length/2;n++){let o=n*2;if(n<r.length-3){let i=this.readSeparator(":",n,()=>this.readIPv4Addr());if(i!==void 0)return r[o]=i[0],r[o+1]=i[1],r[o+2]=i[2],r[o+3]=i[3],[o+4,!0]}let s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[o,!1];r[o]=s>>8,r[o+1]=s&255}return[r.length,!1]};return this.readAtomically(()=>{let r=new Uint8Array(16),[n,o]=t(r);if(n===16)return r;if(o||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let s=new Uint8Array(14),i=16-(n+2),[a]=t(s.subarray(0,i));return r.set(s.subarray(0,a),16-a),r})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var Kf=45,Rf=15,qr=new Hr;function vo(e){if(!(e.length>Rf))return qr.new(e).parseWith(()=>qr.readIPv4Addr())}function Ao(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>Kf))return qr.new(e).parseWith(()=>qr.readIPv6Addr())}function Vr(e){return!!vo(e)}function Ui(e){return!!Ao(e)}function Bo(e){return t=>R(t,e)}function _o(e){return t=>k(t,e)}function De(e){return new DataView(e.buffer).getUint16(e.byteOffset).toString()}function oe(e){let t=new ArrayBuffer(2);return new DataView(t).setUint16(0,typeof e=="string"?parseInt(e):e),new Uint8Array(t)}function Ki(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==16)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);let r=k(t[0],"base32"),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=oe(n);return Tt([r,o],r.length+o.length)}function Ri(e){let t=e.split(":");if(t.length!==2)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(t[0].length!==56)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);let r=Mt.decode(`b${t[0]}`),n=parseInt(t[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let o=oe(n);return Tt([r,o],r.length+o.length)}function Co(e){let t=e.subarray(0,e.length-2),r=e.subarray(e.length-2),n=R(t,"base32"),o=De(r);return`${n}:${o}`}var To=function(e){e=e.toString().trim();let t=new Uint8Array(4);return e.split(/\./g).forEach((r,n)=>{let o=parseInt(r,10);if(isNaN(o)||o<0||o>255)throw new tt("Invalid byte value in IP address");t[n]=o}),t},Ni=function(e){let t=0;e=e.toString().trim();let r=e.split(":",8),n;for(n=0;n<r.length;n++){let s=Vr(r[n]),i;s&&(i=To(r[n]),r[n]=R(i.subarray(0,2),"base16")),i!=null&&++n<8&&r.splice(n,0,R(i.subarray(2,4),"base16"))}if(r[0]==="")for(;r.length<8;)r.unshift("0");else if(r[r.length-1]==="")for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&r[n]!=="";n++);let s=[n,1];for(n=9-r.length;n>0;n--)s.push("0");r.splice.apply(r,s)}let o=new Uint8Array(t+16);for(n=0;n<r.length;n++){r[n]===""&&(r[n]="0");let s=parseInt(r[n],16);if(isNaN(s)||s<0||s>65535)throw new tt("Invalid byte value in IP address");o[t++]=s>>8&255,o[t++]=s&255}return o},ki=function(e){if(e.byteLength!==4)throw new tt("IPv4 address was incorrect length");let t=[];for(let r=0;r<e.byteLength;r++)t.push(e[r]);return t.join(".")},Mi=function(e){if(e.byteLength!==16)throw new tt("IPv6 address was incorrect length");let t=[];for(let n=0;n<e.byteLength;n+=2){let o=e[n],s=e[n+1],i=`${o.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;t.push(i)}let r=t.join(":");try{let n=new URL(`http://[${r}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new tt(`Invalid IPv6 address "${r}"`)}};function Hi(e){try{let t=new URL(`http://[${e}]`);return t.hostname.substring(1,t.hostname.length-1)}catch{throw new tt(`Invalid IPv6 address "${e}"`)}}var Io=Object.values(Re).map(e=>e.decoder),Nf=function(){let e=Io[0].or(Io[1]);return Io.slice(2).forEach(t=>e=e.or(t)),e}();function qi(e){return Nf.decode(e)}function Vi(e){return t=>e.encoder.encode(t)}function kf(e){if(parseInt(e).toString()!==e)throw new Nt("Value must be an integer")}function Mf(e){if(e<0)throw new Nt("Value must be a positive integer, or zero")}function Hf(e){return t=>{if(t>e)throw new Nt(`Value must be smaller than or equal to ${e}`)}}function qf(...e){return t=>{for(let r of e)r(t)}}var nr=qf(kf,Mf,Hf(65535));var et=-1,Do=class{protocolsByCode=new Map;protocolsByName=new Map;getCodec(t){let r;if(typeof t=="string"?r=this.protocolsByName.get(t):r=this.protocolsByCode.get(t),r==null)throw new Mr(`Protocol ${t} was unknown`);return r}addCodec(t,r,n){this.protocolsByCode.set(t,r),this.protocolsByName.set(r.name,r),n?.forEach(o=>{this.protocolsByName.set(o,r)})}deleteCodec(t){let r=this.getCodec(t);r!=null&&(this.protocolsByCode.delete(r.code),this.protocolsByName.delete(r.name),r.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}},yt=new Do,bu=[{code:4,name:"ip4",size:32,valueToBytes:To,bytesToValue:ki,validate:e=>{if(!Vr(e))throw new Nt(`Invalid IPv4 address "${e}"`)}},{code:6,name:"tcp",size:16,valueToBytes:oe,bytesToValue:De,validate:nr},{code:273,name:"udp",size:16,valueToBytes:oe,bytesToValue:De,validate:nr},{code:33,name:"dccp",size:16,valueToBytes:oe,bytesToValue:De,validate:nr},{code:41,name:"ip6",size:128,valueToBytes:Ni,bytesToValue:Mi,stringToValue:Hi,validate:e=>{if(!Ui(e))throw new Nt(`Invalid IPv6 address "${e}"`)}},{code:42,name:"ip6zone",size:et},{code:43,name:"ipcidr",size:8,bytesToValue:Bo("base10"),valueToBytes:_o("base10")},{code:53,name:"dns",size:et,resolvable:!0},{code:54,name:"dns4",size:et,resolvable:!0},{code:55,name:"dns6",size:et,resolvable:!0},{code:56,name:"dnsaddr",size:et,resolvable:!0},{code:132,name:"sctp",size:16,valueToBytes:oe,bytesToValue:De,validate:nr},{code:301,name:"udt"},{code:302,name:"utp"},{code:400,name:"unix",size:et,path:!0,stringToValue:e=>decodeURIComponent(e),valueToString:e=>encodeURIComponent(e)},{code:421,name:"p2p",aliases:["ipfs"],size:et,bytesToValue:Bo("base58btc"),valueToBytes:e=>e.startsWith("Q")||e.startsWith("1")?_o("base58btc")(e):Z.parse(e).multihash.bytes},{code:444,name:"onion",size:96,bytesToValue:Co,valueToBytes:Ki},{code:445,name:"onion3",size:296,bytesToValue:Co,valueToBytes:Ri},{code:446,name:"garlic64",size:et},{code:447,name:"garlic32",size:et},{code:448,name:"tls"},{code:449,name:"sni",size:et},{code:454,name:"noise"},{code:460,name:"quic"},{code:461,name:"quic-v1"},{code:465,name:"webtransport"},{code:466,name:"certhash",size:et,bytesToValue:Vi(pn),valueToBytes:qi},{code:480,name:"http"},{code:481,name:"http-path",size:et,stringToValue:e=>`/${decodeURIComponent(e)}`,valueToString:e=>encodeURIComponent(e.substring(1))},{code:443,name:"https"},{code:477,name:"ws"},{code:478,name:"wss"},{code:479,name:"p2p-websocket-star"},{code:277,name:"p2p-stardust"},{code:275,name:"p2p-webrtc-star"},{code:276,name:"p2p-webrtc-direct"},{code:280,name:"webrtc-direct"},{code:281,name:"webrtc"},{code:290,name:"p2p-circuit"},{code:777,name:"memory",size:et}];bu.forEach(e=>{yt.addCodec(e.code,e,e.aliases)});function zi(e){let t=[],r=0;for(;r<e.length;){let n=$n(e,r),o=yt.getCodec(n),s=_t(n),i=xu(o,e,r+s),a=0;i>0&&o.size===et&&(a=_t(i));let c=s+a+i,l={code:n,name:o.name,bytes:e.subarray(r,r+c)};if(i>0){let f=r+s+a,u=e.subarray(f,f+i);l.value=o.bytesToValue?.(u)??R(u)}t.push(l),r+=c}return t}function Fi(e){let t=0,r=[];for(let n of e){if(n.bytes==null){let o=yt.getCodec(n.code),s=_t(n.code),i,a=0,c=0;n.value!=null&&(i=o.valueToBytes?.(n.value)??k(n.value),a=i.byteLength,o.size===et&&(c=_t(a)));let l=new Uint8Array(s+c+a),f=0;Ze(n.code,l,f),f+=s,i!=null&&(o.size===et&&(Ze(a,l,f),f+=c),l.set(i,f)),n.bytes=l}r.push(n.bytes),t+=n.bytes.byteLength}return Tt(r,t)}function ji(e){if(e.charAt(0)!=="/")throw new tt('String multiaddr must start with "/"');let t=[],r="protocol",n="",o="";for(let s=1;s<e.length;s++){let i=e.charAt(s);i!=="/"&&(r==="protocol"?o+=e.charAt(s):n+=e.charAt(s));let a=s===e.length-1;if(i==="/"||a){let c=yt.getCodec(o);if(r==="protocol"){if(c.size==null||c.size===0){t.push({code:c.code,name:c.name}),n="",o="",r="protocol";continue}else if(a)throw new tt(`Component ${o} was missing value`);r="value"}else if(r==="value"){let l={code:c.code,name:c.name};if(c.size!=null&&c.size!==0){if(n==="")throw new tt(`Component ${o} was missing value`);l.value=c.stringToValue?.(n)??n}t.push(l),n="",o="",r="protocol"}}}if(o!==""&&n!=="")throw new tt("Incomplete multiaddr");return t}function Gi(e){return`/${e.flatMap(t=>{if(t.value==null)return t.name;let r=yt.getCodec(t.code);if(r==null)throw new tt(`Unknown protocol code ${t.code}`);return[t.name,r.valueToString?.(t.value)??t.value]}).join("/")}`}function xu(e,t,r){return e.size==null||e.size===0?0:e.size>0?e.size/8:$n(t,r)}var gu=Symbol.for("nodejs.util.inspect.custom"),ko=Symbol.for("@multiformats/multiaddr"),wu=[53,54,55,56],No=class extends Error{constructor(t="No available resolver"){super(t),this.name="NoAvailableResolverError"}};function Eu(e){if(e==null&&(e="/"),Zi(e))return e.getComponents();if(e instanceof Uint8Array)return zi(e);if(typeof e=="string")return e=e.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),e===""&&(e="/"),ji(e);if(Array.isArray(e))return e;throw new tt("Must be a string, Uint8Array, Component[], or another Multiaddr")}var $r=class e{[ko]=!0;#t;#e;#r;constructor(t="/",r={}){this.#t=Eu(t),r.validate!==!1&&Su(this)}get bytes(){return this.#r==null&&(this.#r=Fi(this.#t)),this.#r}toString(){return this.#e==null&&(this.#e=Gi(this.#t)),this.#e}toJSON(){return this.toString()}toOptions(){let t,r,n,o,s="";for(let{code:a,name:c,value:l}of this.#t)a===42&&(s=`%${l??""}`),wu.includes(a)&&(r="tcp",o=443,n=`${l??""}${s}`,t=a===55?6:4),(a===6||a===273)&&(r=c==="tcp"?"tcp":"udp",o=parseInt(l??"")),(a===4||a===41)&&(r="tcp",n=`${l??""}${s}`,t=a===41?6:4);if(t==null||r==null||n==null||o==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:t,host:n,transport:r,port:o}}getComponents(){return[...this.#t]}protos(){return this.#t.map(({code:t,value:r})=>{let n=yt.getCodec(t);return{code:t,size:n.size??0,name:n.name,resolvable:!!n.resolvable,path:!!n.path}})}protoCodes(){return this.#t.map(({code:t})=>t)}protoNames(){return this.#t.map(({name:t})=>t)}tuples(){return this.#t.map(({code:t,value:r})=>{if(r==null)return[t];let n=yt.getCodec(t),o=[t];return r!=null&&o.push(n.valueToBytes?.(r)??k(r)),o})}stringTuples(){return this.#t.map(({code:t,value:r})=>r==null?[t]:[t,r])}encapsulate(t){let r=new e(t);return new e([...this.#t,...r.getComponents()],{validate:!1})}decapsulate(t){let r=t.toString(),n=this.toString(),o=n.lastIndexOf(r);if(o<0)throw new rr(`Address ${this.toString()} does not contain subaddress: ${t.toString()}`);return new e(n.slice(0,o),{validate:!1})}decapsulateCode(t){let r;for(let n=this.#t.length-1;n>-1;n--)if(this.#t[n].code===t){r=n;break}return new e(this.#t.slice(0,r),{validate:!1})}getPeerId(){try{let t=[];this.#t.forEach(({code:n,value:o})=>{n===421&&t.push([n,o]),n===290&&(t=[])});let r=t.pop();if(r?.[1]!=null){let n=r[1];return n[0]==="Q"||n[0]==="1"?R(V.decode(`z${n}`),"base58btc"):R(Z.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(let t of this.#t)if(yt.getCodec(t.code).path)return t.value??null;return null}equals(t){return nt(this.bytes,t.bytes)}async resolve(t){let r=this.protos().find(s=>s.resolvable);if(r==null)return[this];let n=$i.get(r.name);if(n==null)throw new No(`no available resolver for ${r.name}`);return(await n(this,t)).map(s=>sr(s))}nodeAddress(){let t=this.toOptions();if(t.transport!=="tcp"&&t.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${t.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:t.family,address:t.host,port:t.port}}isThinWaistAddress(){return!(this.#t.length!==2||this.#t[0].code!==4&&this.#t[0].code!==41||this.#t[1].code!==6&&this.#t[1].code!==273)}[gu](){return`Multiaddr(${this.toString()})`}};function Su(e){e.getComponents().forEach(t=>{let r=yt.getCodec(t.code);t.value!=null&&r.validate?.(t.value)})}var gm=parseInt("0xFFFF",16),wm=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);var $i=new Map;function Zi(e){return!!e?.[ko]}function sr(e){return new $r(e)}var ir;(function(e){let t;e.codec=()=>(t==null&&(t=_e((r,n,o={})=>{if(o.lengthDelimited!==!1&&n.fork(),r.publicKey!=null&&r.publicKey.byteLength>0&&(n.uint32(10),n.bytes(r.publicKey)),r.addrs!=null)for(let s of r.addrs)n.uint32(18),n.bytes(s);o.lengthDelimited!==!1&&n.ldelim()},(r,n,o={})=>{let s={publicKey:gt(0),addrs:[]},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let a=r.uint32();switch(a>>>3){case 1:{s.publicKey=r.bytes();break}case 2:{if(o.limits?.addrs!=null&&s.addrs.length===o.limits.addrs)throw new Dr('Decode error - map field "addrs" had too many elements');s.addrs.push(r.bytes());break}default:{r.skipType(a&7);break}}}return s})),t),e.encode=r=>Ie(r,e.codec()),e.decode=(r,n)=>Ae(r,e.codec(),n)})(ir||(ir={}));var Xi="_peer-discovery._p2p._pubsub",Zr=class extends ar{[Mo]=!0;[Symbol.toStringTag]="@libp2p/pubsub-peer-discovery";interval;listenOnly;topics;intervalId;components;log;constructor(t,r={}){super();let{interval:n,topics:o,listenOnly:s}=r;this.components=t,this.interval=n??1e4,this.listenOnly=s??!1,this.log=t.logger.forComponent("libp2p:discovery:pubsub"),Array.isArray(o)&&o.length>0?this.topics=o:this.topics=[Xi],this._onMessage=this._onMessage.bind(this)}isStarted(){return this.intervalId!=null}start(){}afterStart(){if(this.intervalId!=null)return;let t=this.components.pubsub;if(t==null)throw new Error("PubSub not configured");for(let r of this.topics)t.subscribe(r),t.addEventListener("message",this._onMessage);this.listenOnly||(this._broadcast(),this.intervalId=setInterval(()=>{this._broadcast()},this.interval))}beforeStop(){let t=this.components.pubsub;if(t==null)throw new Error("PubSub not configured");for(let r of this.topics)t.unsubscribe(r),t.removeEventListener("message",this._onMessage)}stop(){this.intervalId!=null&&(clearInterval(this.intervalId),this.intervalId=void 0)}_broadcast(){let t=this.components.peerId;if(t.publicKey==null)throw new Error("PeerId was missing public key");let r={publicKey:qt(t.publicKey),addrs:this.components.addressManager.getAddresses().map(s=>s.bytes)},n=ir.encode(r),o=this.components.pubsub;if(o==null)throw new Error("PubSub not configured");for(let s of this.topics){if(o.getSubscribers(s).length===0){this.log("skipping broadcasting our peer data on topic %s because there are no peers present",s);continue}this.log("broadcasting our peer data on topic %s",s),o.publish(s,n)}}_onMessage(t){if(!this.isStarted())return;let r=t.detail;if(this.topics.includes(r.topic))try{let n=ir.decode(r.data),o=Di(n.publicKey),s=Li(o);if(s.equals(this.components.peerId))return;this.log("discovered peer %p on %s",s,r.topic),this.safeDispatchEvent("peer",{detail:{id:s,multiaddrs:n.addrs.map(i=>sr(i))}})}catch(n){this.log.error("error handling incoming message",n)}}};function _u(e={}){return t=>new Zr(t,e)}return ra(Cu);})();
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/curves/esm/utils.js:
@noble/curves/esm/abstract/modular.js:
@noble/curves/esm/abstract/curve.js:
@noble/curves/esm/abstract/edwards.js:
@noble/curves/esm/ed25519.js:
@noble/curves/esm/abstract/weierstrass.js:
@noble/curves/esm/_shortw_utils.js:
@noble/curves/esm/secp256k1.js:
  (*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
return Libp2PPubsubPeerDiscovery}));
//# sourceMappingURL=index.min.js.map
